import{E as k,ae as D,x as i,d as f,aa as p,H as h,a as s,a7 as d,Q as $,w as _,T as b,J as A,o as v,c as M,a9 as w}from"./index.d78f815c.js";import{_ as N}from"./index.es6.db79449e.js";import{_ as O}from"./searchToolbar.a33518ca.js";import{C as V}from"./compareTable.b4f845a3.js";import{b as j}from"./constantVariable.1ceb2543.js";import{u as P}from"./use-quasar.6ef15f16.js";import"./QSelect.77d64708.js";import"./use-key-composition.8fe7b499.js";import"./uid.42677368.js";import"./QMenu.c8dbaa4e.js";import"./selection.faaa34c1.js";import"./rtl.b51694b1.js";import"./towerSelect.9436c179.js";import"./QInput.72a273ff.js";import"./QTooltip.cf77d385.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./QSeparator.ac17e27e.js";const Q={class:"tw-flex tw-items-center"},T={key:0,class:"tw-mt-3"},ne=k({__name:"ArchivePage",setup(U){const C=D(),m=P(),r=i([]),a=i([]),l=i(""),c=i(!0),y=t=>{r.value=t},x=async()=>{if(u.value.length!==Object.keys(g.value).length)return;const t={order:"effectiveDate DESC",include:["member"],where:{}};u.value.forEach(n=>{t.where[n.name]={$eq:null}});let e=[];r.value.forEach(n=>{n&&n.name!=="__NONE__"&&(t.where[n.base]=n.name,e.push(n.name))}),a.value.push({id:Math.random().toString(),loading:!0,path:e.join(" / ")});const o=a.value.length-1;try{const n=await A.get(`configurations?filter=${JSON.stringify(t,null,"")}`);n.status===200&&n.data.length>0?(a.value[o].configuration=n.data.reverse(),a.value[o].version=n.data.length-1,a.value[o].loading=!1):(m.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:"Configuration doesn't exist"}),a.value.splice(o,1))}catch{m.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:"Error collecting configuration data"}),a.value.splice(o,1)}},E=t=>{a.value=a.value.filter(e=>e.id!==t.toString())},I=t=>{const e=a.value.findIndex(o=>o.id===t.configId.toString());e>=0&&(a.value[e].version=t.version)},B=t=>{const e=a.value.find(o=>`${o.id}`===t.sourceId);if(e){const o=a.value.findIndex(n=>`${n.id}`===t.targetId);o>=0&&(a.value=a.value.filter(n=>`${n.id}`!==t.sourceId),a.value.splice(o,0,e))}},g=f(()=>{if(!r.value)return{};const t={};return r.value.forEach(e=>{e!=null&&e.base&&(t[e.base]=e.name)}),t}),u=f(()=>C.getBases),S=f(()=>{const t=new Set;return a.value.forEach(e=>{j(e.version)&&e.configuration&&e.configuration[e.version]&&e.configuration[e.version].variables.forEach(o=>{t.add(o.name)})}),Array.from(t).sort((e,o)=>e.localeCompare(o,void 0,{sensitivity:"base"}))});return(t,e)=>(v(),p("div",null,[h("div",Q,[s(N,{class:"tw-flex-grow","onUpdate:baseModels":y}),h("div",null,[s($,{disable:d(u).length!==Object.keys(d(g)).length||a.value.length>3,flat:"",icon:"sym_o_add",onClick:x},null,8,["disable"])])]),s(b,{"enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"},{default:_(()=>[a.value.length>0?(v(),M(O,{key:0,filter:l.value,"onUpdate:filter":e[0]||(e[0]=o=>l.value=o),showDiff:c.value,"onUpdate:showDiff":e[1]||(e[1]=o=>c.value=o),"export-enabled":!1,"import-enabled":!1,class:"tw-mt-3",title:"Archive"},null,8,["filter","showDiff"])):w("",!0)]),_:1}),s(b,{"enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"},{default:_(()=>[a.value.length>0?(v(),p("div",T,[s(V,{configs:a.value,filter:l.value,showDiff:c.value,variables:d(S),onRemoveConfiguration:E,onSwitchPlaces:B,onVersionChanged:I},null,8,["configs","filter","showDiff","variables"])])):w("",!0)]),_:1})]))}});export{ne as default};
