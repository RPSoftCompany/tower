import{Q as de}from"./QTooltip.cf77d385.js";import{b as Qe,d as D,h as te,f as He,aD as wa,Q as z,C as ya,E as Ae,o,c as I,w as g,a as s,I as ve,a7 as r,aa as k,a5 as M,a9 as h,aE as ha,a8 as q,aF as pa,x as E,k as X,aG as Ve,aH as pe,H as S,aI as De,aJ as xe,aK as Ie,aL as Be,a4 as K,ac as le,ad as he,ae as qe,F as Xe,a3 as Ye,aM as Ke,J as ye,T as $e,aN as Ze,aO as ea,aP as Va,as as aa,ag as xa,$ as ka,ai as Aa,a0 as Ca,am as _a,n as Sa,aQ as Ia,j as $a,O as Ea,aR as Na}from"./index.d78f815c.js";import{d as Ue,Q as ta,a as la,_ as Da}from"./index.es6.db79449e.js";import{_ as Ba}from"./searchToolbar.a33518ca.js";import{Q as fe}from"./QSeparator.ac17e27e.js";import{t as me,v as ne,a as ge,C as P,b as na,Q as oa}from"./constantVariable.1ceb2543.js";import{u as ra}from"./use-quasar.6ef15f16.js";import{Q as J}from"./QInput.72a273ff.js";import{a as Ua,h as Ta}from"./use-key-composition.8fe7b499.js";import{Q as Me,a as Ee}from"./QSelect.77d64708.js";import{Q as Te}from"./QCheckbox.c616ffd9.js";import{Q as je,b as ke}from"./QMenu.c8dbaa4e.js";import{_ as sa}from"./savePanel.faa1b35b.js";import{_ as ia}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as Ra}from"./QList.7f34605a.js";import{Q as Oa}from"./QSlideTransition.bbbb1b6f.js";import{u as Fe}from"./uid.42677368.js";import{c as Ge}from"./browser.97da8d21.js";import{A as Pa}from"./index.dd8b4ad7.js";import"./selection.faaa34c1.js";import"./towerSelect.9436c179.js";import"./rtl.b51694b1.js";var La=Qe({name:"QBtnGroup",props:{unelevated:Boolean,outline:Boolean,flat:Boolean,rounded:Boolean,square:Boolean,push:Boolean,stretch:Boolean,glossy:Boolean,spread:Boolean},setup(e,{slots:U}){const n=D(()=>{const w=["unelevated","outline","flat","rounded","square","push","stretch","glossy"].filter(b=>e[b]===!0).map(b=>`q-btn-group--${b}`).join(" ");return`q-btn-group row no-wrap${w.length>0?" "+w:""}`+(e.spread===!0?" q-btn-group--spread":" inline")});return()=>te("div",{class:n.value},He(U.default))}}),Re=Qe({name:"QBtnToggle",props:{...Ua,modelValue:{required:!0},options:{type:Array,required:!0,validator:e=>e.every(U=>("label"in U||"icon"in U||"slot"in U)&&"value"in U)},color:String,textColor:String,toggleColor:{type:String,default:"primary"},toggleTextColor:String,outline:Boolean,flat:Boolean,unelevated:Boolean,rounded:Boolean,push:Boolean,glossy:Boolean,size:String,padding:String,noCaps:Boolean,noWrap:Boolean,dense:Boolean,readonly:Boolean,disable:Boolean,stack:Boolean,stretch:Boolean,spread:Boolean,clearable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","clear","click"],setup(e,{slots:U,emit:n}){const w=D(()=>e.options.find(p=>p.value===e.modelValue)!==void 0),b=D(()=>({type:"hidden",name:e.name,value:e.modelValue})),A=Ta(b),T=D(()=>wa(e)),f=D(()=>({rounded:e.rounded,dense:e.dense,...T.value})),m=D(()=>e.options.map((p,O)=>{const{attrs:R,value:Q,slot:Z,...v}=p;return{slot:Z,props:{key:O,"aria-pressed":Q===e.modelValue?"true":"false",...R,...v,...f.value,disable:e.disable===!0||v.disable===!0,color:Q===e.modelValue?t(v,"toggleColor"):t(v,"color"),textColor:Q===e.modelValue?t(v,"toggleTextColor"):t(v,"textColor"),noCaps:t(v,"noCaps")===!0,noWrap:t(v,"noWrap")===!0,size:t(v,"size"),padding:t(v,"padding"),ripple:t(v,"ripple"),stack:t(v,"stack")===!0,stretch:t(v,"stretch")===!0,onClick(u){a(Q,p,u)}}}}));function a(p,O,R){e.readonly!==!0&&(e.modelValue===p?e.clearable===!0&&(n("update:modelValue",null,null),n("clear")):n("update:modelValue",p,O),n("click",R))}function t(p,O){return p[O]===void 0?e[O]:p[O]}function x(){const p=m.value.map(O=>te(z,O.props,O.slot!==void 0?U[O.slot]:void 0));return e.name!==void 0&&e.disable!==!0&&w.value===!0&&A(p,"push"),ya(U.default,p)}return()=>te(La,{class:"q-btn-toggle",...T.value,rounded:e.rounded,stretch:e.stretch,glossy:e.glossy,spread:e.spread},x)}});const Ma={key:0,class:"tw-ml-3"},Oe=Ae({__name:"typeSelect",props:["modelValue","withLabel","disabled","standard"],emits:["update:modelValue"],setup(e,{emit:U}){const n=e,w=D({get:()=>n.modelValue,set:A=>U("update:modelValue",A)}),b=A=>{const T=me.find(f=>f.value===A);return T?T.icon:""};return(A,T)=>(o(),I(Ee,{modelValue:r(w),"onUpdate:modelValue":T[0]||(T[0]=f=>pa(w)?w.value=f:null),borderless:!e.standard,disable:e.disabled,options:r(me),color:"secondary",dense:"","options-dense":"","popup-content-class":"shadow-black"},{selected:g(()=>[s(ve,{name:b(r(w).value),size:"sm"},null,8,["name"]),e.withLabel?(o(),k("span",Ma,M(r(w).label),1)):h("",!0)]),option:g(({itemProps:f,opt:m})=>[s(je,ha({class:"tw-text-secondary"},f),{default:g(()=>[s(ke,{class:"tw-flex"},{default:g(()=>[s(ve,{name:b(m.value),size:"sm"},null,8,["name"])]),_:2},1024),s(ke,null,{default:g(()=>[s(Me,{class:"tw-min-w-[5rem]"},{default:g(()=>[q(M(m.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","borderless","disable","options"]))}}),Qa=S("div",{class:"text-h6"},"Remove constant variable",-1),qa={class:"tw-italic"},ja={key:0,class:"tw-text-center tw-self-center tw-col-span-2"},Wa={key:0,class:"tw-italic tw-text-gray-500"},za={key:1,class:"tw-flex 2xl:tw-flex-row tw-flex-col tw-my-0.5"},Fa={class:"tw-flex tw-grow"},Ga={class:"tw-text-center tw-grow tw-self-center fullWordWrap"},Ja={key:0},Ha={key:1},Xa={key:0,class:"tw-text-negative tw-line-through"},Ya={key:1,class:"tw-text-positive"},Ka={key:2},Za={key:3,class:"tw-italic tw-text-gray-500 tw-line-through"},et={class:"tw-flex tw-self-center"},at={class:"tw-flex-grow tw-mx-2"},tt={key:2,class:"tw-text-center tw-self-center tw-italic tw-text-gray-500"},lt=Ae({__name:"constantVariableRow",props:{grid:null,name:null,type:null,value:{type:[String,Number,Array,Boolean,null]},forced:{type:Boolean},addIfAbsent:{type:Boolean},deleted:{type:Boolean},isNew:{type:Boolean},disable:{type:Boolean},showDiff:{type:Boolean},currentArchive:null,currentVersion:null},emits:["removeVariable","update:value","update:type","update:forced","update:addIfAbsent","addVariable"],setup(e,{emit:U}){const n=e,w=v=>{const u=me.find(C=>C.value===v);return u?u.icon:""},b=()=>{U("removeVariable",f.value)},A=()=>{var v,u,C,$,G,ee,N,F,ae,ie,ce,ue,V,i;if(n.deleted){U("addVariable",{name:f.value,type:(v=n.currentArchive)==null?void 0:v.type,value:(u=n.currentArchive)==null?void 0:u.value,forced:(C=n.currentArchive)==null?void 0:C.forced,addIfAbsent:($=n.currentArchive)==null?void 0:$.addIfAbsent});return}if(((G=n.currentArchive)==null?void 0:G.type)&&m.value.value!==((ee=n.currentArchive)==null?void 0:ee.type)){const B=me.find(j=>{var _;return j.value===((_=n.currentArchive)==null?void 0:_.type)});B!==void 0&&(m.value=B)}((N=n.currentArchive)==null?void 0:N.forced)!==void 0&&t.value!==((F=n.currentArchive)==null?void 0:F.forced)&&(t.value=n.currentArchive.forced),((ae=n.currentArchive)==null?void 0:ae.addIfAbsent)!==void 0&&x.value!==((ie=n.currentArchive)==null?void 0:ie.addIfAbsent)&&(x.value=(ce=n.currentArchive)==null?void 0:ce.addIfAbsent),((ue=n.currentArchive)==null?void 0:ue.value)!==void 0&&a.value!==((V=n.currentArchive)==null?void 0:V.value)&&(a.value=(i=n.currentArchive)==null?void 0:i.value)},T=(v,u)=>n.deleted?Ue(u,""):Ue(u,v),f=E(n.name),m=E({label:"",value:n.type,icon:w(n.type)}),a=E(n.value),t=E(n.forced),x=E(n.addIfAbsent),p=E(!1),O=E(!1),R=D(()=>{if(n.currentArchive){const v=me.find(u=>{var C;return u.value===((C=n.currentArchive)==null?void 0:C.type)});if(v)return v.icon}}),Q=D(()=>{if(n.deleted)return!0;if(n.currentArchive){const v=n.currentArchive;return v.type!==m.value.value||ne(v.value)!==ne(a.value)||v.addIfAbsent!==x.value||v.forced!==t.value}else return!1}),Z=D(()=>{if(n.deleted)return!0;if(n.currentVersion){const v=n.currentVersion;return v.type!==m.value.value||ne(v.value)!==ne(a.value)||v.addIfAbsent!==x.value||v.forced!==t.value}return!1});return X(m,()=>{a.value=ge(a.value,m.value.value),U("update:type",m.value.value),U("update:value",a.value)},{immediate:!0}),X(a,()=>{U("update:value",a.value)}),X(t,()=>{U("update:forced",t.value)}),X(x,()=>{U("update:addIfAbsent",x.value)}),X(()=>n.value,()=>{a.value=n.value}),X(()=>n.type,v=>{v!==m.value.value&&(m.value={label:"",value:v,icon:w(v)})}),X(()=>n.addIfAbsent,v=>{x.value=v}),X(()=>n.forced,v=>{t.value=v}),(v,u)=>{var C,$,G,ee;return o(),k("div",null,[s(Be,{modelValue:p.value,"onUpdate:modelValue":u[0]||(u[0]=N=>p.value=N),persistent:""},{default:g(()=>[s(Ve,{class:"tw-min-w-[30%]"},{default:g(()=>[s(pe,{class:"tw-bg-negative"},{default:g(()=>[Qa]),_:1}),s(pe,null,{default:g(()=>[q(" Are you sure you want to remove "),S("span",qa,M(f.value),1),q(" constant variable? ")]),_:1}),s(De,{align:"right"},{default:g(()=>[xe(s(z,{color:"secondary",flat:"",label:"Cancel"},null,512),[[Ie]]),xe(s(z,{color:"negative",flat:"",label:"Yes",onClick:b},null,512),[[Ie]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),S("div",{class:K([{"tw-grid-cols-2":e.grid===2,"tw-grid-cols-5":e.grid===3,"tw-rounded":r(Z)||e.isNew||e.deleted,configurationRowModified:r(Z)||e.isNew||e.deleted},"tw-grid tw-w-full tw-gap-3 tw-min-h-[2.75rem] tw-pl-2 tw-mr-2 tw-my-px"])},[S("div",{class:K([{"tw-line-through":e.deleted,"tw-italic":e.deleted,"tw-text-gray-500":e.deleted},"tw-self-center fullWordWrap"])},M(f.value),3),e.grid===3?(o(),k("div",ja,[e.currentArchive?(o(),k("div",za,[S("div",Fa,[s(ve,{class:K([{"tw-bg-secondary":e.currentArchive.type!==m.value.value&&!e.deleted&&e.showDiff,deleted:e.deleted},"tw-flex-none tw-p-2 tw-mx-0.5 tw-rounded tw-self-center"]),color:e.currentArchive.type!==m.value.value&&e.showDiff?"dark":void 0,name:r(R),size:"sm"},null,8,["class","color","name"]),S("div",Ga,[m.value.value===r(P).PASSWORD&&!O.value?(o(),k("div",Ja," \u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022 ")):r(na)(e.currentArchive)&&!e.deleted?(o(),k("div",Ha,[e.showDiff?(o(!0),k(le,{key:0},he(T(r(ne)(a.value),r(ne)((C=e.currentArchive)==null?void 0:C.value)),(N,F)=>(o(),k(le,{key:`${N.value}_${F}`},[N.removed?(o(),k("span",Xa,M(N.value),1)):N.added?(o(),k("span",Ya,M(N.value),1)):(o(),k("span",Ka,M(N.value),1))],64))),128)):(o(),k(le,{key:1},[q(M(r(ne)(e.currentArchive.value)),1)],64))])):(($=e.currentArchive)==null?void 0:$.value)===null?(o(),k("div",{key:2,class:K([{"tw-line-through":e.deleted},"tw-italic tw-text-gray-500"])}," Empty value ",2)):e.deleted?(o(),k("div",Za,M(a.value),1)):h("",!0)])]),S("div",et,[s(ve,{class:K([{"tw-bg-secondary":e.currentArchive.forced!==t.value&&!e.deleted&&e.showDiff,deleted:e.deleted},"tw-flex-none tw-p-2 tw-mx-0.5 tw-rounded"]),color:((G=e.currentArchive)==null?void 0:G.forced)!==t.value&&e.showDiff?"dark":void 0,name:(ee=e.currentArchive)!=null&&ee.forced?"sym_o_edit_off":"sym_o_edit",size:"sm"},null,8,["class","color","name"]),s(ve,{class:K([{"tw-bg-secondary":e.currentArchive.addIfAbsent!==x.value&&!e.deleted&&e.showDiff,deleted:e.deleted},"tw-flex-none tw-p-2 tw-mx-0.5 tw-rounded"]),color:e.currentArchive.addIfAbsent!==x.value&&e.showDiff?"dark":void 0,name:e.currentArchive.addIfAbsent?"sym_o_published_with_changes":"sym_o_sync_disabled",size:"sm"},null,8,["class","color","name"]),s(fe,{inset:"",vertical:""}),s(z,{disable:!r(Q),flat:"",icon:"sym_o_undo",padding:"sm",onClick:A},{default:g(()=>[r(Q)?(o(),I(de,{key:0},{default:g(()=>[q(M(e.deleted?"Recreate variable":"Undo changes"),1)]),_:1})):h("",!0)]),_:1},8,["disable"])])])):(o(),k("div",Wa," Variable doesn't exist in this version "))])):h("",!0),e.deleted?(o(),k("div",tt," Deleted variable ")):(o(),k("div",{key:1,class:K([{"tw-col-span-2":e.grid===3},"tw-flex tw-self-center"])},[s(Oe,{modelValue:m.value,"onUpdate:modelValue":u[1]||(u[1]=N=>m.value=N),disable:e.disable},null,8,["modelValue","disable"]),S("div",at,[m.value.value===r(P).STRING?(o(),I(J,{key:0,modelValue:a.value,"onUpdate:modelValue":u[2]||(u[2]=N=>a.value=N),disable:e.disable,color:"secondary",dense:""},null,8,["modelValue","disable"])):h("",!0),m.value.value===r(P).PASSWORD?(o(),I(J,{key:1,modelValue:a.value,"onUpdate:modelValue":u[4]||(u[4]=N=>a.value=N),disable:e.disable,type:O.value?"text":"password",color:"secondary",dense:""},{append:g(()=>[s(z,{icon:O.value?"sym_o_lock":"sym_o_lock_open",flat:"",padding:"sm",onClick:u[3]||(u[3]=N=>O.value=!O.value)},null,8,["icon"])]),_:1},8,["modelValue","disable","type"])):h("",!0),m.value.value===r(P).NUMBER?(o(),I(J,{key:2,modelValue:a.value,"onUpdate:modelValue":u[5]||(u[5]=N=>a.value=N),disable:e.disable,color:"secondary",dense:"",type:"number"},null,8,["modelValue","disable"])):h("",!0),m.value.value===r(P).BOOLEAN?(o(),I(Re,{key:3,modelValue:a.value,"onUpdate:modelValue":u[6]||(u[6]=N=>a.value=N),disable:e.disable,options:[{label:"True",value:!0},{label:"False",value:!1}],class:"tw-mt-1.5",dense:"",spread:"","toggle-color":"dark",unelevated:""},null,8,["modelValue","disable"])):h("",!0),m.value.value===r(P).TEXT?(o(),I(J,{key:4,modelValue:a.value,"onUpdate:modelValue":u[7]||(u[7]=N=>a.value=N),disable:e.disable,color:"secondary",dense:"",type:"textarea"},null,8,["modelValue","disable"])):h("",!0),m.value.value===r(P).LIST?(o(),I(Ee,{key:5,modelValue:a.value,"onUpdate:modelValue":u[8]||(u[8]=N=>a.value=N),disable:e.disable,color:"secondary",dense:"","hide-dropdown-icon":"","input-debounce":"0",multiple:"","new-value-mode":"add","use-chips":"","use-input":""},null,8,["modelValue","disable"])):h("",!0),m.value.value===r(P).VAULT?(o(),I(J,{key:6,modelValue:a.value,"onUpdate:modelValue":u[9]||(u[9]=N=>a.value=N),disable:e.disable,color:"secondary",dense:""},null,8,["modelValue","disable"])):h("",!0)]),s(Te,{modelValue:t.value,"onUpdate:modelValue":u[10]||(u[10]=N=>t.value=N),disable:e.disable,"checked-icon":"sym_o_edit_off",size:"lg","unchecked-icon":"sym_o_edit"},{default:g(()=>[s(de,null,{default:g(()=>[q("Editable in configuration")]),_:1})]),_:1},8,["modelValue","disable"]),s(Te,{modelValue:x.value,"onUpdate:modelValue":u[11]||(u[11]=N=>x.value=N),disable:e.disable,"checked-icon":"sym_o_published_with_changes",size:"lg","unchecked-icon":"sym_o_sync_disabled"},{default:g(()=>[s(de,null,{default:g(()=>[q("Add variable if not in configuration")]),_:1})]),_:1},8,["modelValue","disable"]),s(fe,{inset:"",vertical:""}),s(z,{disable:e.disable,flat:"",icon:"sym_o_delete",padding:"sm",onClick:u[12]||(u[12]=N=>p.value=!0)},null,8,["disable"])],2))],2)])}}}),nt={class:"tw-w-full tw-grid tw-grid-cols-3 tw-gap-3 tw-content-center"},ot={class:"tw-flex"},rt={class:"tw-flex-grow tw-mx-2"},st=Ae({__name:"newConstantVariablePanel",props:{existingVariableNames:{default:()=>[]}},emits:["addNewConstantVariable"],setup(e,{emit:U}){const n=E(null),w=E(me[0]),b=E(""),A=E(!0),T=E(!0),f=E(!1),m=E(null),a=()=>{U("addNewConstantVariable",{name:n.value,type:w.value.value,value:b.value,forced:A.value,addIfAbsent:T.value,isNew:!0}),n.value=null,w.value=me[0],b.value="",A.value=!0,T.value=!0};return X(()=>w.value.value,()=>{b.value=ge(b.value,w.value.value)}),(t,x)=>(o(),I(Ve,{class:"tw-bg-darkPage tw-text-secondary tw-px-4 tw-pb-1 tw-pt-1 tw-rounded",flat:""},{default:g(()=>[S("div",nt,[s(J,{ref_key:"nameRef",ref:m,modelValue:n.value,"onUpdate:modelValue":x[0]||(x[0]=p=>n.value=p),rules:[p=>!e.existingVariableNames.includes(p)||"Variable with this name exists already"],color:"secondary",dense:"",label:"New constant variable name"},null,8,["modelValue","rules"]),s(Oe,{modelValue:w.value,"onUpdate:modelValue":x[1]||(x[1]=p=>w.value=p),standard:!0,withLabel:!0},null,8,["modelValue"]),S("div",ot,[S("div",rt,[w.value.value===r(P).STRING?(o(),I(J,{key:0,modelValue:b.value,"onUpdate:modelValue":x[2]||(x[2]=p=>b.value=p),color:"secondary",dense:"",label:"New constant variable value"},null,8,["modelValue"])):h("",!0),w.value.value===r(P).PASSWORD?(o(),I(J,{key:1,modelValue:b.value,"onUpdate:modelValue":x[4]||(x[4]=p=>b.value=p),type:f.value?"text":"password",color:"secondary",dense:"",label:"New constant variable value"},{append:g(()=>[s(z,{icon:f.value?"sym_o_lock":"sym_o_lock_open",flat:"",padding:"sm",onClick:x[3]||(x[3]=p=>f.value=!f.value)},null,8,["icon"])]),_:1},8,["modelValue","type"])):h("",!0),w.value.value===r(P).NUMBER?(o(),I(J,{key:2,modelValue:b.value,"onUpdate:modelValue":x[5]||(x[5]=p=>b.value=p),color:"secondary",dense:"",label:"New constant variable value",type:"number"},null,8,["modelValue"])):h("",!0),w.value.value===r(P).BOOLEAN?(o(),I(Re,{key:3,modelValue:b.value,"onUpdate:modelValue":x[6]||(x[6]=p=>b.value=p),options:[{label:"True",value:!0},{label:"False",value:!1}],class:"tw-mt-1.5",dense:"",spread:"","toggle-color":"primary"},null,8,["modelValue"])):h("",!0),w.value.value===r(P).TEXT?(o(),I(J,{key:4,modelValue:b.value,"onUpdate:modelValue":x[7]||(x[7]=p=>b.value=p),color:"secondary",dense:"",label:"New constant variable value",type:"textarea"},null,8,["modelValue"])):h("",!0),w.value.value===r(P).LIST?(o(),I(Ee,{key:5,modelValue:b.value,"onUpdate:modelValue":x[8]||(x[8]=p=>b.value=p),color:"secondary",dense:"","hide-dropdown-icon":"","input-debounce":"0",label:"New constant variable value",multiple:"","new-value-mode":"add","use-chips":"","use-input":""},null,8,["modelValue"])):h("",!0),w.value.value===r(P).VAULT?(o(),I(J,{key:6,modelValue:b.value,"onUpdate:modelValue":x[9]||(x[9]=p=>b.value=p),color:"secondary",dense:"",label:"New constant variable value"},null,8,["modelValue"])):h("",!0)]),s(Te,{modelValue:A.value,"onUpdate:modelValue":x[10]||(x[10]=p=>A.value=p),"checked-icon":"sym_o_edit_off",size:"lg","unchecked-icon":"sym_o_edit"},{default:g(()=>[s(de,null,{default:g(()=>[q("Editable in configuration")]),_:1})]),_:1},8,["modelValue"]),s(Te,{modelValue:T.value,"onUpdate:modelValue":x[11]||(x[11]=p=>T.value=p),"checked-icon":"sym_o_published_with_changes",size:"lg","unchecked-icon":"sym_o_sync_disabled"},{default:g(()=>[s(de,null,{default:g(()=>[q("Add variable if not in configuration")]),_:1})]),_:1},8,["modelValue"]),s(fe,{inset:"",vertical:""}),s(z,{disable:!n.value||m.value.hasError,flat:"",icon:"sym_o_add",padding:"sm",onClick:a},{default:g(()=>[n.value&&!m.value.hasError?(o(),I(de,{key:0},{default:g(()=>[q("Add new constant variable ")]),_:1})):h("",!0)]),_:1},8,["disable"])])])]),_:1}))}});const We=e=>(Ze("data-v-34fe389c"),e=e(),ea(),e),it=We(()=>S("div",{class:"tw-mt-3"},"Please wait, loading...",-1)),ut={key:0,class:"tw-w-full tw-flex tw-justify-center tw-items-center"},dt={class:"tw-text-lg tw-tracking-wide tw-italic tw-text-gray-400"},ct={key:0,class:"tw-text-center tw-text-xs tw-text-gray-500"},vt=We(()=>S("div",{class:"tw-text-center tw-w-full"},"Name",-1)),ft={key:0,class:"tw-flex tw-col-span-2"},mt={class:"tw-grow tw-self-center tw-flex tw-justify-center"},gt={class:"tw-mr-3 tw-self-center"},bt={class:"tw-text-center tw-text-gray-600 tw-font-light tw-text-xs"},wt={class:"tw-font-medium"},yt={key:0,class:"tw-flex tw-self-center"},ht={key:0,class:"tw-w-full tw-h-full tw-flex tw-justify-center tw-items-center"},pt=We(()=>S("div",{class:"tw-text-lg tw-tracking-wide tw-italic tw-text-gray-400"},[q(" All variables have been filtered out "),S("div",{class:"tw-text-center tw-text-xs tw-text-gray-500"}," Please update your filter in the panel above ")],-1)),Vt=[pt],xt={key:0},kt=Ae({__name:"constantVariablePanel",props:{configModel:{default:()=>[]},filter:{default:""},showDiff:{type:Boolean,default:!0}},setup(e,{expose:U}){const n=e,w=ra(),b=qe(),A=Xe(),T=Ye(),f=E(null),m=E([]),a=E(!1),t=E(-1);Ke(async()=>{await C()});const x=D(()=>t.value>=0?new Date(m.value[t.value].effectiveDate).toLocaleString():new Date),p=D(()=>{var V;return t.value>=0?(V=m.value[t.value].createdBy)==null?void 0:V.username:""}),O=D(()=>A.hasAdminRights?!0:A.getRoles.includes("constantVariable.modify")),R=D(()=>ue()),Q=D(()=>ue(t.value)),Z=D(()=>{var i;const V=[];return(i=f.value)!=null&&i.variables&&f.value.variables.forEach(B=>{V.push(B.name)}),V}),v=D(()=>{var i;let V=[];if((i=f.value)!=null&&i.variables&&(V=[...f.value.variables]),m.value.length>0&&m.value[t.value].variables.forEach(B=>{V.some(_=>B.name===_.name)||V.push({name:B.name,addIfAbsent:B.addIfAbsent,forced:B.forced,type:B.type,value:B.value,deleted:!0})}),V.sort((B,j)=>B.name.localeCompare(j.name,void 0,{sensitivity:"base"})),n.filter){const B=n.filter.toLocaleLowerCase("en-US");V=V.filter(j=>{if(j.name.toLocaleLowerCase("en-US").includes(B)||j.type===B)return!0;let _=ne(j.value);return _&&(_=_.toLocaleLowerCase("en-US")),_.includes(B)})}return V}),u=D(()=>{var V,i;return!!((V=f.value)!=null&&V.variables)&&((i=f.value)==null?void 0:i.variables.length)>0}),C=async()=>{if(t.value=-1,f.value=null,m.value=[],T.allowNavigation(),!n.configModel)return;a.value=!0;const V={order:"effectiveDate DESC",include:["member"],where:{}};b.getBases.forEach(i=>{V.where[i.name]={$eq:null}}),n.configModel.forEach(i=>{i&&(V.where[i.base]=i.name)});try{const i=await ye.get(`constantVariables?filter=${JSON.stringify(V,null,"")}`);i.status===200&&(f.value=null,m.value=[],i.data.length>0&&(f.value=structuredClone(i.data[0]),m.value=i.data.reverse(),m.value.length>0&&(t.value=m.value.length-1)))}catch{w.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:"Error collecting constant variable data"})}a.value=!1},$=(V,i)=>(i=i||t.value,i<0||!m.value[i]?void 0:m.value[i].variables.find(j=>j.name===V)),G=V=>{var i;f.value&&(f.value.variables=(i=f.value)==null?void 0:i.variables.filter(B=>B.name!==V))},ee=V=>{f.value?f.value.variables.push(V):(f.value={effectiveDate:new Date,createdBy:"",id:"",variables:[V]},n.configModel.forEach(i=>{i&&f.value&&(f.value[i.base]=i.name)}))},N=async()=>{if(a.value=!0,f.value){const V={variables:[]};f.value.variables.forEach(i=>{V.variables.push({name:i.name,type:i.type,value:i.value,addIfAbsent:i.addIfAbsent,forced:i.forced})}),b.getBases.forEach(i=>{f.value&&f.value[i.name]&&(V[i.name]=f.value[i.name])});try{(await ye.post("constantVariables",V)).status===201&&(await C(),w.notify({color:"positive",position:"top",textColor:"secondary",icon:"sym_o_check",message:"Constant variables saved correctly"}))}catch{w.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:"Error saving constant variables"})}}a.value=!1},F=()=>{var i;if(!((i=f.value)!=null&&i.variables))return;let V=null;return V=ae(),JSON.stringify(V)},ae=()=>{var i;const V={constantVariables:[]};return(i=f.value)==null||i.variables.forEach(B=>{V.constantVariables&&V.constantVariables.push({name:B.name,type:B.type,value:B.value,addIfAbsent:B.addIfAbsent,forced:B.forced})}),V},ie=V=>{let i=null;try{i=JSON.parse(V.fileData)}catch{w.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:"Error exporting configuration - invalid file data"});return}if(i){if(!i.constantVariables||i.constantVariables.length===0){w.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:"Error exporting constant variables - constant variables data not present"});return}f.value||(f.value={createdBy:"",effectiveDate:new Date,id:"",variables:[]});const B=[];i.constantVariables.forEach(j=>{B.push({name:j.name,type:j.type,value:ge(j.value,j.type),addIfAbsent:j.addIfAbsent,forced:j.forced})}),f.value.variables=B,w.notify({color:"positive",position:"top",textColor:"secondary",message:"Constant variables exported successfully"})}},ce=()=>{f.value&&m.value[t.value]&&(f.value.variables=[],m.value[t.value].variables.forEach(V=>{var i;(i=f.value)==null||i.variables.push({name:V.name,type:V.type,value:V.value,forced:V.forced,addIfAbsent:V.addIfAbsent})}))},ue=V=>{var i,B,j;if(m.value.length===0&&((i=f.value)==null?void 0:i.variables.length)===0)return!1;if(m.value.length===0&&((B=f.value)==null?void 0:B.variables.length)!==0)return!0;if(m.value.length>0){const _=V||m.value.length-1,L=m.value[_];return L.variables.length!==((j=f.value)==null?void 0:j.variables.length)?!0:L.variables.some(Y=>{var Ne;const be=(Ne=f.value)==null?void 0:Ne.variables.find(Le=>Le.name===Y.name);return be?be.type!==Y.type||be.forced!==Y.forced||ne(be.value)!==ne(Y.value)||be.addIfAbsent!==Y.addIfAbsent:!0})}return!1};return X(()=>n.configModel,C,{immediate:!1,deep:!0}),X(R,V=>{V&&!a.value?T.preventNavigation():T.allowNavigation()}),U({importConfiguration:F,exportConfiguration:ie,userCanModify:O,importEnabled:u}),(V,i)=>(o(),k(le,null,[s(Ve,{class:"tw-bg-darkPage tw-text-secondary tw-gap-3 row tw-pt-2 tw-rounded tower-min-height tw-flex-1",flat:""},{default:g(()=>{var B,j,_;return[s(ta,{showing:a.value},{default:g(()=>[s(la,{color:"secondary",size:"3em"}),it]),_:1},8,["showing"]),!((B=f.value)!=null&&B.variables)&&!a.value?(o(),k("div",ut,[S("div",dt,[q(" There aren't any constant variables in this configuration "),r(O)?(o(),k("div",ct," You can create one using panel below ")):h("",!0)])])):h("",!0),!a.value&&((j=f.value)==null?void 0:j.variables)?(o(),k("div",{key:1,class:K([{"tower-max-height":r(O),"tower-max-height-readOnly":!r(O)},"tw-w-full"])},[S("div",{class:K([{"tw-grid-cols-5":m.value.length>0,"tw-grid-cols-2":m.value.length===0},"tw-grid tw-w-full tw-gap-3 tw-justify-items-stretch tw-place-items-center tw-text-sm tw-font-semibold tw-min-h-[2.5rem]"])},[vt,m.value.length>0?(o(),k("div",ft,[s(z,{disable:t.value<=0,class:"tw-flex-none",flat:"",icon:"sym_o_chevron_left",padding:"sm",onClick:i[0]||(i[0]=L=>t.value--)},null,8,["disable"]),S("div",mt,[S("div",gt,[S("div",null," Version #"+M(t.value+1)+", created "+M(r(x)),1),S("div",bt,[q(" created by "),S("span",wt,M(r(p)),1)])]),r(O)?(o(),k("div",yt,[s(fe,{inset:"",vertical:""}),s(z,{disable:!r(Q),flat:"",icon:"sym_o_undo",padding:"sm",onClick:ce},{default:g(()=>[r(Q)?(o(),I(de,{key:0},{default:g(()=>[q("Revert to this version ")]),_:1})):h("",!0)]),_:1},8,["disable"])])):h("",!0)]),s(z,{disable:t.value>=m.value.length-1,class:"tw-flex-none",flat:"",icon:"sym_o_chevron_right",padding:"sm",onClick:i[1]||(i[1]=L=>t.value++)},null,8,["disable"])])):h("",!0),S("div",{class:K([{"tw-col-span-2":m.value.length>0},"tw-text-center tw-w-full"])}," Value ",2)],2),S("div",{class:K({"tw-col-span-2":m.value.length>0})},[(o(!0),k(le,null,he(r(v),L=>(o(),I(oa,{key:L.name,class:"tower-configuration-row","ssr-prerender":"",transition:"fade"},{default:g(()=>[s(lt,{"add-if-absent":L.addIfAbsent,"onUpdate:addIfAbsent":Y=>L.addIfAbsent=Y,forced:L.forced,"onUpdate:forced":Y=>L.forced=Y,type:L.type,"onUpdate:type":Y=>L.type=Y,value:L.value,"onUpdate:value":Y=>L.value=Y,"current-archive":$(L.name),"current-version":$(L.name,m.value.length-1),deleted:L.deleted,disable:!r(O),grid:m.value.length>0?3:2,"is-new":L.isNew,name:L.name,showDiff:e.showDiff,onAddVariable:ee,onRemoveVariable:G},null,8,["add-if-absent","onUpdate:addIfAbsent","forced","onUpdate:forced","type","onUpdate:type","value","onUpdate:value","current-archive","current-version","deleted","disable","grid","is-new","name","showDiff"])]),_:2},1024))),128))],2),r(v).length===0&&e.filter&&((_=f.value)==null?void 0:_.variables.length)>0?(o(),k("div",ht,Vt)):h("",!0)],2)):h("",!0)]}),_:1}),r(O)?(o(),k("div",xt,[s($e,{"enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"},{default:g(()=>[a.value?h("",!0):(o(),I(st,{key:0,"existing-variable-names":r(Z),onAddNewConstantVariable:ee},null,8,["existing-variable-names"]))]),_:1}),s($e,{"enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"},{default:g(()=>{var B;return[(B=f.value)!=null&&B.variables?(o(),I(sa,{key:0,"save-enabled":r(R)&&!a.value,onSaveClicked:N},null,8,["save-enabled"])):h("",!0)]}),_:1})])):h("",!0)],64))}});var At=ia(kt,[["__scopeId","data-v-34fe389c"]]);const Se=Va({}),Ct=Object.keys(aa);var _t=Qe({name:"QExpansionItem",props:{...aa,...xa,...ka,icon:String,label:String,labelLines:[Number,String],caption:String,captionLines:[Number,String],dense:Boolean,toggleAriaLabel:String,expandIcon:String,expandedIcon:String,expandIconClass:[Array,String,Object],duration:Number,headerInsetLevel:Number,contentInsetLevel:Number,expandSeparator:Boolean,defaultOpened:Boolean,hideExpandIcon:Boolean,expandIconToggle:Boolean,switchToggleSide:Boolean,denseToggle:Boolean,group:String,popup:Boolean,headerStyle:[Array,String,Object],headerClass:[Array,String,Object]},emits:[...Aa,"click","afterShow","afterHide"],setup(e,{slots:U,emit:n}){const{proxy:{$q:w}}=$a(),b=Ca(e,w),A=E(e.modelValue!==null?e.modelValue:e.defaultOpened),T=E(null),f=Fe(),{show:m,hide:a,toggle:t}=_a({showing:A});let x,p;const O=D(()=>`q-expansion-item q-item-type q-expansion-item--${A.value===!0?"expanded":"collapsed"} q-expansion-item--${e.popup===!0?"popup":"standard"}`),R=D(()=>{if(e.contentInsetLevel===void 0)return null;const _=w.lang.rtl===!0?"Right":"Left";return{["padding"+_]:e.contentInsetLevel*56+"px"}}),Q=D(()=>e.disable!==!0&&(e.href!==void 0||e.to!==void 0&&e.to!==null&&e.to!=="")),Z=D(()=>{const _={};return Ct.forEach(L=>{_[L]=e[L]}),_}),v=D(()=>Q.value===!0||e.expandIconToggle!==!0),u=D(()=>e.expandedIcon!==void 0&&A.value===!0?e.expandedIcon:e.expandIcon||w.iconSet.expansionItem[e.denseToggle===!0?"denseIcon":"icon"]),C=D(()=>e.disable!==!0&&(Q.value===!0||e.expandIconToggle===!0)),$=D(()=>({expanded:A.value===!0,detailsId:e.targetUid,toggle:t,show:m,hide:a})),G=D(()=>{const _=e.toggleAriaLabel!==void 0?e.toggleAriaLabel:w.lang.label[A.value===!0?"collapse":"expand"](e.label);return{role:"button","aria-expanded":A.value===!0?"true":"false","aria-controls":f,"aria-label":_}});X(()=>e.group,_=>{p!==void 0&&p(),_!==void 0&&ce()});function ee(_){Q.value!==!0&&t(_),n("click",_)}function N(_){_.keyCode===13&&F(_,!0)}function F(_,L){L!==!0&&T.value!==null&&T.value.focus(),t(_),Ea(_)}function ae(){n("afterShow")}function ie(){n("afterHide")}function ce(){x===void 0&&(x=Fe()),A.value===!0&&(Se[e.group]=x);const _=X(A,Y=>{Y===!0?Se[e.group]=x:Se[e.group]===x&&delete Se[e.group]}),L=X(()=>Se[e.group],(Y,be)=>{be===x&&Y!==void 0&&Y!==x&&a()});p=()=>{_(),L(),Se[e.group]===x&&delete Se[e.group],p=void 0}}function ue(){const _={class:[`q-focusable relative-position cursor-pointer${e.denseToggle===!0&&e.switchToggleSide===!0?" items-end":""}`,e.expandIconClass],side:e.switchToggleSide!==!0,avatar:e.switchToggleSide},L=[te(ve,{class:"q-expansion-item__toggle-icon"+(e.expandedIcon===void 0&&A.value===!0?" q-expansion-item__toggle-icon--rotated":""),name:u.value})];return C.value===!0&&(Object.assign(_,{tabindex:0,...G.value,onClick:F,onKeyup:N}),L.unshift(te("div",{ref:T,class:"q-expansion-item__toggle-focus q-icon q-focus-helper q-focus-helper--rounded",tabindex:-1}))),te(ke,_,()=>L)}function V(){let _;return U.header!==void 0?_=[].concat(U.header($.value)):(_=[te(ke,()=>[te(Me,{lines:e.labelLines},()=>e.label||""),e.caption?te(Me,{lines:e.captionLines,caption:!0},()=>e.caption):null])],e.icon&&_[e.switchToggleSide===!0?"push":"unshift"](te(ke,{side:e.switchToggleSide===!0,avatar:e.switchToggleSide!==!0},()=>te(ve,{name:e.icon})))),e.disable!==!0&&e.hideExpandIcon!==!0&&_[e.switchToggleSide===!0?"unshift":"push"](ue()),_}function i(){const _={ref:"item",style:e.headerStyle,class:e.headerClass,dark:b.value,disable:e.disable,dense:e.dense,insetLevel:e.headerInsetLevel};return v.value===!0&&(_.clickable=!0,_.onClick=ee,Object.assign(_,Q.value===!0?Z.value:G.value)),te(je,_,V)}function B(){return xe(te("div",{key:"e-content",class:"q-expansion-item__content relative-position",style:R.value,id:f},He(U.default)),[[Ia,A.value]])}function j(){const _=[i(),te(Oa,{duration:e.duration,onShow:ae,onHide:ie},B)];return e.expandSeparator===!0&&_.push(te(fe,{class:"q-expansion-item__border q-expansion-item__border--top absolute-top",dark:b.value}),te(fe,{class:"q-expansion-item__border q-expansion-item__border--bottom absolute-bottom",dark:b.value})),_}return e.group!==void 0&&ce(),Sa(()=>{p!==void 0&&p()}),()=>te("div",{class:O.value},[te("div",{class:"q-expansion-item__container relative-position"},j())])}});const St={class:"tw-relative"},It=S("div",{class:"text-h6"},"Remove constant variable",-1),$t={class:"tw-italic"},Et={key:0,class:"tw-text-center tw-self-center tw-col-span-2"},Nt={key:0,class:"tw-italic tw-text-gray-500"},Dt={key:1,class:"tw-flex 2xl:tw-flex-row tw-flex-col tw-my-0.5"},Bt={class:"tw-flex tw-grow"},Ut={class:"tw-text-center tw-grow tw-self-center fullWordWrap"},Tt={key:0},Rt={key:0,class:"tw-text-negative tw-line-through"},Ot={key:1,class:"tw-text-positive"},Pt={key:2},Lt={key:2,class:"tw-italic tw-text-gray-500 tw-line-through"},Mt={key:0,class:"tw-flex tw-self-center"},Qt={class:"tw-flex-grow tw-mx-2"},qt={key:0,class:"tw-text-negative tw-pt-2 tw-pb-px booleanErrorField tw-break-words"},jt={key:2,class:"tw-text-center tw-self-center tw-italic tw-text-gray-500"},Je=Ae({__name:"configurationVariableRow",props:{grid:null,name:null,type:null,value:{type:[String,Number,Array,Boolean,null]},deleted:{type:Boolean},isConstantVariable:{type:Boolean},forced:{type:Boolean},allowDelete:{type:Boolean},error:null,disable:{type:Boolean},showDiff:{type:Boolean},currentArchive:null},emits:["removeVariable","update:value","update:type","addVariable"],setup(e,{emit:U}){const n=e,w=v=>{const u=me.find(C=>C.value===v);return u?u.icon:""},b=()=>{U("removeVariable",f.value)},A=()=>{var v,u,C,$,G,ee,N;if(n.deleted){U("addVariable",{name:f.value,type:(v=n.currentArchive)==null?void 0:v.type,value:(u=n.currentArchive)==null?void 0:u.value});return}if(((C=n.currentArchive)==null?void 0:C.type)&&a.value!==(($=n.currentArchive)==null?void 0:$.type)){const F=me.find(ae=>{var ie;return ae.value===((ie=n.currentArchive)==null?void 0:ie.type)});F!==void 0&&(a.value=F)}((G=n.currentArchive)==null?void 0:G.value)!==void 0&&t.value!==((ee=n.currentArchive)==null?void 0:ee.value)&&(t.value=(N=n.currentArchive)==null?void 0:N.value)},T=(v,u)=>n.deleted?Ue(u,""):Ue(u,v),f=E(n.name);let m=!0;const a=E("");m=!0,typeof n.type=="string"?a.value={label:"",value:n.type,icon:w(n.type)}:a.value=E(n.type),m=!0;const t=E(n.value),x=E(!1),p=E(!1),O=D(()=>{if(n.currentArchive){const v=me.find(u=>{var C;return u.value===((C=n.currentArchive)==null?void 0:C.type)});if(v)return v.icon}}),R=D(()=>{if(n.deleted)return!0;if(n.currentArchive){const v=typeof a.value=="string"?a.value:a.value.value,u=n.currentArchive;return u.type!==v||ne(u.value)!==ne(t.value)}else return!1}),Q=D(()=>{if(n.deleted||!n.currentArchive&&!n.isConstantVariable)return!0;if(n.currentArchive){const v=typeof a.value=="string"?a.value:a.value.value,u=n.currentArchive;return u.type!==v||ge(u.value,P.STRING)!==ge(t.value,P.STRING)}return!1}),Z=D(()=>typeof a.value=="string"?a.value:a.value.value);return X(a,()=>{const v=typeof a.value=="string"?a.value:a.value.value;t.value=ge(t.value,v),U("update:type",v),U("update:value",t.value),n.isConstantVariable&&!n.forced&&!m&&U("addVariable",{name:f.value,type:v,value:t.value}),m=!1},{immediate:!0}),X(t,()=>{if(U("update:value",t.value),n.isConstantVariable&&!n.forced&&!m){const v=typeof a.value=="string"?a.value:a.value.value;U("addVariable",{name:f.value,type:v,value:t.value})}m=!1}),X(()=>n.value,v=>{v!==t.value&&(m=!0,t.value=v)}),X(()=>n.type,v=>{v!==a.value&&(m=!0,a.value={label:"",value:v,icon:w(v)})}),(v,u)=>{var C,$,G,ee,N,F,ae,ie,ce,ue,V;return o(),k("div",St,[s(Be,{modelValue:x.value,"onUpdate:modelValue":u[0]||(u[0]=i=>x.value=i),persistent:""},{default:g(()=>[s(Ve,{class:"tw-min-w-[30%]"},{default:g(()=>[s(pe,{class:"tw-bg-negative"},{default:g(()=>[It]),_:1}),s(pe,null,{default:g(()=>[q(" Are you sure you want to remove "),S("span",$t,M(f.value),1),q(" constant variable? ")]),_:1}),s(De,{align:"right"},{default:g(()=>[xe(s(z,{color:"secondary",flat:"",label:"Cancel"},null,512),[[Ie]]),xe(s(z,{color:"negative",flat:"",label:"Yes",onClick:b},null,512),[[Ie]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),S("div",{class:K([{"tw-grid-cols-2":e.grid===2,"tw-grid-cols-5":e.grid===3,"tw-rounded":r(Q)||!!e.error,configurationRowModified:r(Q),configurationRowError:!!e.error},"tw-grid tw-w-full tw-gap-3 tw-min-h-[2.75rem] tw-pl-2 tw-mr-2 tw-my-px"])},[S("div",{class:K([{"tw-line-through":e.deleted,"tw-italic":e.deleted,"tw-text-gray-500":e.deleted},"tw-self-center fullWordWrap tw-flex"])},[e.isConstantVariable?(o(),I(ve,{key:0,class:"tw-pr-2 filled tw-self-center",name:"sym_o_bookmark",size:"sm"},{default:g(()=>[s(de,{delay:300},{default:g(()=>[q("Constant variable")]),_:1})]),_:1})):h("",!0),S("div",null,M(f.value),1)],2),e.grid===3?(o(),k("div",Et,[e.currentArchive?(o(),k("div",Dt,[S("div",Bt,[e.forced?h("",!0):(o(),I(ve,{key:0,class:K([{"tw-bg-secondary":e.currentArchive.type!==((C=a.value)==null?void 0:C.value)&&!e.deleted&&e.showDiff,deleted:e.deleted},"tw-flex-none tw-p-2 tw-mx-0.5 tw-rounded tw-self-center"]),color:e.currentArchive.type!==(($=a.value)==null?void 0:$.value)&&e.showDiff?"dark":void 0,name:r(O),size:"sm"},null,8,["class","color","name"])),S("div",Ut,[r(na)(e.currentArchive)&&!e.deleted?(o(),k("div",Tt,[r(Z)===r(P).PASSWORD&&!p.value?(o(),k(le,{key:0},[q(" \u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022 ")],64)):(o(),k(le,{key:1},[e.showDiff?(o(!0),k(le,{key:0},he(T(r(ne)(t.value),r(ne)((G=e.currentArchive)==null?void 0:G.value)),(i,B)=>(o(),k(le,{key:`${i.value}_${B}`},[i.removed?(o(),k("span",Rt,M(i.value),1)):i.added?(o(),k("span",Ot,M(i.value),1)):(o(),k("span",Pt,M(i.value),1))],64))),128)):(o(),k(le,{key:1},[q(M(r(ne)(e.currentArchive.value)),1)],64))],64))])):((ee=e.currentArchive)==null?void 0:ee.value)===null?(o(),k("div",{key:1,class:K([{"tw-line-through":e.deleted},"tw-italic tw-text-gray-500"])}," Empty value ",2)):e.deleted?(o(),k("div",Lt,M(t.value),1)):h("",!0)])]),e.forced?h("",!0):(o(),k("div",Mt,[s(fe,{inset:"",vertical:""}),s(z,{disable:!r(R),flat:"",icon:"sym_o_undo",padding:"sm",onClick:A},{default:g(()=>[r(R)?(o(),I(de,{key:0},{default:g(()=>[q(M(e.deleted?"Recreate variable":"Undo changes"),1)]),_:1})):h("",!0)]),_:1},8,["disable"])]))])):(o(),k("div",Nt," Variable doesn't exist in this version "))])):h("",!0),e.deleted?(o(),k("div",jt," Deleted variable ")):(o(),k("div",{key:1,class:K([{"tw-col-span-2":e.grid===3},"tw-flex tw-self-center"])},[s(Oe,{modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=i=>a.value=i),disabled:e.forced,class:"tw-self-center"},null,8,["modelValue","disabled"]),S("div",Qt,[((N=a.value)==null?void 0:N.value)===r(P).STRING?(o(),I(J,{key:0,modelValue:t.value,"onUpdate:modelValue":u[2]||(u[2]=i=>t.value=i),debounce:300,disable:e.forced,error:!!e.error,"error-message":e.error,"hide-bottom-space":!0,color:"secondary",dense:""},null,8,["modelValue","disable","error","error-message"])):h("",!0),((F=a.value)==null?void 0:F.value)===r(P).PASSWORD?(o(),I(J,{key:1,modelValue:t.value,"onUpdate:modelValue":u[4]||(u[4]=i=>t.value=i),debounce:300,disable:e.forced,error:!!e.error,"error-message":e.error,"hide-bottom-space":!0,type:p.value?"text":"password",color:"secondary",dense:""},{append:g(()=>[s(z,{icon:p.value?"sym_o_lock":"sym_o_lock_open",flat:"",padding:"sm",onClick:u[3]||(u[3]=i=>p.value=!p.value)},null,8,["icon"])]),_:1},8,["modelValue","disable","error","error-message","type"])):h("",!0),((ae=a.value)==null?void 0:ae.value)===r(P).NUMBER?(o(),I(J,{key:2,modelValue:t.value,"onUpdate:modelValue":u[5]||(u[5]=i=>t.value=i),disable:e.forced,error:!!e.error,"error-message":e.error,"hide-bottom-space":!0,color:"secondary",dense:"","input-debounce":"300",type:"number"},null,8,["modelValue","disable","error","error-message"])):h("",!0),((ie=a.value)==null?void 0:ie.value)===r(P).BOOLEAN?(o(),k(le,{key:3},[s(Re,{modelValue:t.value,"onUpdate:modelValue":u[6]||(u[6]=i=>t.value=i),disable:e.forced,options:[{label:"True",value:!0},{label:"False",value:!1}],"toggle-color":e.error?"negative":"dark",class:"tw-mt-1.5",dense:"",spread:"",unelevated:""},null,8,["modelValue","disable","toggle-color"]),e.error?(o(),k("div",qt,M(e.error),1)):h("",!0)],64)):h("",!0),((ce=a.value)==null?void 0:ce.value)===r(P).TEXT?(o(),I(J,{key:4,modelValue:t.value,"onUpdate:modelValue":u[7]||(u[7]=i=>t.value=i),disable:e.forced,error:!!e.error,"error-message":e.error,"hide-bottom-space":!0,color:"secondary",dense:"",type:"textarea"},null,8,["modelValue","disable","error","error-message"])):h("",!0),((ue=a.value)==null?void 0:ue.value)===r(P).LIST?(o(),I(Ee,{key:5,modelValue:t.value,"onUpdate:modelValue":u[8]||(u[8]=i=>t.value=i),disable:e.forced,error:!!e.error,"error-message":e.error,"hide-bottom-space":!0,color:"secondary",dense:"","hide-dropdown-icon":"","input-debounce":"300",multiple:"","new-value-mode":"add","use-chips":"","use-input":""},null,8,["modelValue","disable","error","error-message"])):h("",!0),((V=a.value)==null?void 0:V.value)===r(P).VAULT?(o(),I(J,{key:6,modelValue:t.value,"onUpdate:modelValue":u[9]||(u[9]=i=>t.value=i),disable:e.forced,error:!!e.error,"error-message":e.error,"hide-bottom-space":!0,color:"secondary",dense:"","input-debounce":"300"},null,8,["modelValue","disable","error","error-message"])):h("",!0)]),s(fe,{inset:"",vertical:""}),s(z,{disable:!e.allowDelete,flat:"",icon:"sym_o_delete",padding:"sm",onClick:u[10]||(u[10]=i=>x.value=!0)},null,8,["disable"])],2))],2)])}}}),Wt={class:"tw-w-full tw-grid tw-grid-cols-3 tw-gap-3 tw-content-center"},zt={class:"tw-flex"},Ft={class:"tw-flex-grow tw-mx-2"},Gt=Ae({__name:"newConfigurationVariablePanel",props:{existingVariableNames:{default:()=>[]}},emits:["addNewVariable"],setup(e,{emit:U}){const n=E(null),w=E(me[0]),b=E(""),A=E(!1),T=E(null),f=()=>{U("addNewVariable",{name:n.value,type:w.value.value,value:b.value}),n.value=null,w.value=me[0],b.value=""};return(m,a)=>(o(),I(Ve,{class:"tw-bg-darkPage tw-text-secondary tw-pb-1 tw-pt-1 tw-rounded",flat:""},{default:g(()=>[S("div",Wt,[s(J,{ref_key:"nameRef",ref:T,modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=t=>n.value=t),rules:[t=>!e.existingVariableNames.includes(t)||"Variable with this name already exists in the configuration"],color:"secondary",dense:"",label:"New variable name"},null,8,["modelValue","rules"]),s(Oe,{modelValue:w.value,"onUpdate:modelValue":a[1]||(a[1]=t=>w.value=t),standard:!0,withLabel:!0},null,8,["modelValue"]),S("div",zt,[S("div",Ft,[w.value.value===r(P).STRING?(o(),I(J,{key:0,modelValue:b.value,"onUpdate:modelValue":a[2]||(a[2]=t=>b.value=t),color:"secondary",dense:"",label:"New variable value"},null,8,["modelValue"])):h("",!0),w.value.value===r(P).PASSWORD?(o(),I(J,{key:1,modelValue:b.value,"onUpdate:modelValue":a[4]||(a[4]=t=>b.value=t),type:A.value?"text":"password",color:"secondary",dense:"",label:"New variable value"},{append:g(()=>[s(z,{icon:A.value?"sym_o_lock":"sym_o_lock_open",flat:"",padding:"sm",onClick:a[3]||(a[3]=t=>A.value=!A.value)},null,8,["icon"])]),_:1},8,["modelValue","type"])):h("",!0),w.value.value===r(P).NUMBER?(o(),I(J,{key:2,modelValue:b.value,"onUpdate:modelValue":a[5]||(a[5]=t=>b.value=t),color:"secondary",dense:"",label:"New variable value",type:"number"},null,8,["modelValue"])):h("",!0),w.value.value===r(P).BOOLEAN?(o(),I(Re,{key:3,modelValue:b.value,"onUpdate:modelValue":a[6]||(a[6]=t=>b.value=t),options:[{label:"True",value:!0},{label:"False",value:!1}],class:"tw-mt-1.5",dense:"",spread:"","toggle-color":"primary"},null,8,["modelValue"])):h("",!0),w.value.value===r(P).TEXT?(o(),I(J,{key:4,modelValue:b.value,"onUpdate:modelValue":a[7]||(a[7]=t=>b.value=t),color:"secondary",dense:"",label:"New variable value",type:"textarea"},null,8,["modelValue"])):h("",!0),w.value.value===r(P).LIST?(o(),I(Ee,{key:5,modelValue:b.value,"onUpdate:modelValue":a[8]||(a[8]=t=>b.value=t),color:"secondary",dense:"","hide-dropdown-icon":"","input-debounce":"0",label:"New variable value",multiple:"","new-value-mode":"add","use-chips":"","use-input":""},null,8,["modelValue"])):h("",!0),w.value.value===r(P).VAULT?(o(),I(J,{key:6,modelValue:b.value,"onUpdate:modelValue":a[9]||(a[9]=t=>b.value=t),color:"secondary",dense:"",label:"New variable value"},null,8,["modelValue"])):h("",!0)]),s(fe,{inset:"",vertical:""}),s(z,{disable:!n.value||T.value.hasError,flat:"",icon:"sym_o_add",padding:"sm",onClick:f},{default:g(()=>[n.value&&!T.value.hasError?(o(),I(de,{key:0},{default:g(()=>[q("Add new configuration variable ")]),_:1})):h("",!0)]),_:1},8,["disable"])])])]),_:1}))}});const Pe=e=>(Ze("data-v-e261c3ae"),e=e(),ea(),e),Jt=Pe(()=>S("div",{class:"text-h6"},"Promotion Candidates",-1)),Ht={class:"text-h6"},Xt={class:"tw-grid tw-grid-cols-2 tw-gap-3"},Yt={class:"fullWordWrap"},Kt={class:"fullWordWrap"},Zt=Pe(()=>S("div",{class:"tw-mt-3"},"Please wait, loading...",-1)),el={key:0,class:"tw-w-full tw-flex tw-justify-center tw-items-center"},al={class:"tw-text-lg tw-tracking-wide tw-italic tw-text-gray-400"},tl={key:0,class:"tw-text-center tw-text-xs tw-text-gray-500"},ll={key:1,class:"tw-w-full tw-flex tw-justify-center tw-items-center"},nl=Pe(()=>S("div",{class:"tw-text-lg tw-tracking-wide tw-italic tw-text-gray-400"},[q(" All variables have been filtered out "),S("div",{class:"tw-text-center tw-text-xs tw-text-gray-500"}," Please update your filter in the panel above ")],-1)),ol=[nl],rl={key:2,class:"tw-w-full"},sl=Pe(()=>S("div",{class:"tw-text-center tw-w-full"},"Name",-1)),il={key:0,class:"tw-flex tw-col-span-2"},ul={class:"tw-grow tw-self-center tw-flex tw-justify-center"},dl={class:"tw-self-center tw-flex tw-mr-3"},cl={class:"tw-mr-3 tw-self-center"},vl={class:"tw-text-center tw-text-gray-600 tw-font-light tw-text-xs"},fl={class:"tw-font-medium"},ml={key:0,class:"tw-flex tw-self-center"},gl={key:0},bl=Ae({__name:"configurationPanel",props:{configModel:{default:()=>[]},filter:{default:""},showDiff:{type:Boolean,default:!0}},emits:["update:promotionCandidates"],setup(e,{expose:U,emit:n}){const w=e,b=ra(),A=qe(),T=Xe(),f=Ye(),m=E(!1),a=E(null),t=E([]),x=E([]),p=E([]),O=E(!1),R=E(-1),Q=E([]),Z=E(!1),v=E(""),u=E(!1),C=E(null);Ke(async()=>{await B()});const $=D(()=>{if(Q.value.length>0){const d=new Map;return Q.value.forEach(c=>{w.configModel.forEach(l=>{var y;if(c[l.base]!==l.name){const W=`${c[l.base]} ${l.base}`;d.has(W)?(y=d.get(W))==null||y.push({id:Ge({length:10}),base:l.base,name:c[l.base],configuration:c}):d.set(W,[{id:Ge({length:10}),base:l.base,name:c[l.base],configuration:c}])}})}),d}return null}),G=D(()=>R.value>=0?new Date(t.value[R.value].effectiveDate).toLocaleString():new Date),ee=D(()=>{var d;return R.value>=0?(d=t.value[R.value].createdBy)==null?void 0:d.username:""}),N=D(()=>R.value>=0?t.value[R.value].promoted:!1),F=D(()=>{if(T.hasAdminRights)return!0;const d={};w.configModel.forEach(c=>{c&&c.name!=="__NONE__"&&(d[c.base]=c.name)});for(let c of A.getBases)if(a.value){const l=`configurationModel.${c.name}.${d[c.name]}`;if(T.getRoles.includes(`${l}.view`)&&!T.getRoles.includes(`${l}.modify`))return!1}return T.getRoles.includes("configuration.modify")}),ae=D(()=>{var c;let d=[];if((c=a.value)!=null&&c.variables&&(d=[...a.value.variables]),x.value.length>0&&x.value.forEach(l=>{const y=d.findIndex(W=>W.name===l.name);y>=0?l.forced&&(d[y].constantVariable=!0,d[y].forced=!0,d[y].value=l.value,d[y].type=l.type):l.addIfAbsent&&d.push({name:l.name,type:l.type,value:l.value,forced:l.forced,addIfAbsent:l.addIfAbsent,constantVariable:!0})}),t.value.length>0&&t.value[R.value].variables.forEach(l=>{d.some(W=>l.name===W.name)||d.push({name:l.name,type:l.type,value:l.value,deleted:!0})}),d=Y(d),d.sort((l,y)=>l.name.localeCompare(y.name,void 0,{sensitivity:"base"})),w.filter){const l=w.filter.toLocaleLowerCase("en-US");d=d.filter(y=>{if(y.name.toLocaleLowerCase("en-US").includes(l)||y.type===l)return!0;let W=ne(y.value);return W&&(W=W.toLocaleLowerCase("en-US")),W.includes(l)})}return d}),ie=D(()=>{var c;const d=new Set;return(c=a.value)!=null&&c.variables&&a.value.variables.forEach(l=>{d.add(l.name)}),x.value.forEach(l=>{l.addIfAbsent&&d.add(l.name)}),Array.from(d)}),ce=D(()=>ze()),ue=D(()=>ze(R.value)),V=D(()=>{var d,c;return!!((d=a.value)!=null&&d.variables)&&((c=a.value)==null?void 0:c.variables.length)>0}),i=D(()=>{if(C.value){let d="";const c=C.value;for(let l of A.getBases)c[l.name]&&(d&&(d+="/"),d+=c[l.name]);return d+=` version. ${c.version}`,d}return""}),B=async()=>{if(a.value=null,x.value=[],p.value=[],t.value=[],Q.value=[],R.value=-1,!w.configModel||!w.configModel.some(y=>y))return;m.value=!0;const c={where:{or:[],rules:{$gt:{$size:0}}}},l={order:"effectiveDate DESC",include:["member"],where:{}};A.getBases.forEach(y=>{l.where[y.name]={$eq:null}}),w.configModel.forEach(y=>{y&&y.name!=="__NONE__"&&(l.where[y.base]=y.name,c.where.or.push({name:y.name}))});try{const y=ye.get(`configurations?filter=${JSON.stringify(l,null,"")}`),W=ye.get(`constantVariables/findLatest?filter=${JSON.stringify(l.where,null,"")}`),Ce=ye.get(`configurationModels?filter=${JSON.stringify(c,void 0,"")}`);let re,H,se;const we=await Promise.all([y,W,Ce]);re=we[0],H=we[1],se=we[2],re.status===200&&(a.value=null,t.value=[],re.data.length>0&&(a.value=structuredClone(re.data[0]),t.value=re.data.reverse(),t.value.length>0&&(R.value=t.value.length-1,F.value&&fa().then(()=>{}).catch(()=>{})))),H.status===200&&(x.value=H.data,x.value.map(oe=>{oe.currentType=oe.type,oe.currentValue=oe.value,oe.from="",A.getBases.forEach(_e=>{oe[_e.name]&&(oe.from?oe.from=oe[_e.name]:oe.from+=`/${oe[_e.name]}`)})})),se.status===200&&se.data.length>0&&se.data.forEach(oe=>{p.value=[...p.value,...oe.rules]})}catch{b.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:"Error collecting configuration data"})}m.value=!1},j=d=>R.value<0||!t.value[R.value]?void 0:t.value[R.value].variables.find(l=>l.name===d),_=d=>{var c,l;a.value||(a.value={createdBy:void 0,description:"",draft:!1,effectiveDate:new Date,version:-1,id:"",promoted:!1,variables:[]}),(c=a.value)!=null&&c.variables.some(y=>y.name===d.name)||(l=a.value)==null||l.variables.push(d)},L=d=>{a.value&&(a.value.variables=a.value.variables.filter(c=>c.name!==d))},Y=d=>(O.value=!1,p.value.length>0&&(d.map(c=>(c.error=void 0,c)),d.map(c=>{if(c.constantVariable&&c.forced)return c;const l=c;p.value.forEach(y=>{let W=!1;if(y.targetRegEx?new RegExp(y.targetValue).test(l[y.targetType])&&(W=!0):l[y.targetType]===y.targetValue&&(W=!0),W){if(y.conditionRegEx){if(!new RegExp(y.conditionValue).test(ne(l[y.conditionType])))return c.error=y.error,O.value=!0,c}else if(ne(l[y.conditionType])!==y.conditionValue)return c.error=y.error,O.value=!0,c}})})),d),be=async()=>{var d,c,l,y,W,Ce;if((d=a.value)!=null&&d.variables){m.value=!0;let re=null;try{const H={variables:(c=a.value)==null?void 0:c.variables,promoted:!1,description:"",draft:!1};w.configModel.forEach(se=>{se&&se.name!=="__NONE__"&&(H[se.base]=se.name)}),re=await ye.post("/configurations",H)}catch(H){let se=H.message;H instanceof Pa&&(se=(y=(l=H.response)==null?void 0:l.data)!=null&&y.message?(Ce=(W=H.response)==null?void 0:W.data)==null?void 0:Ce.message:H.message),b.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:`Error saving configuration data: ${se}`})}re&&re.status===201&&(b.notify({color:"positive",position:"top",textColor:"secondary",message:"Configuration saved successfully"}),await B()),m.value=!1}},Ne=()=>{var c;if(!((c=a.value)!=null&&c.variables))return;let d;return d=Le(),JSON.stringify(d)},Le=()=>{var c;const d={configurationVariables:[]};return(c=a.value)==null||c.variables.forEach(l=>{d.configurationVariables&&d.configurationVariables.push({name:l.name,type:l.type,value:l.value})}),d},ua=d=>{let c=null;try{c=JSON.parse(d.fileData)}catch{b.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:"Error exporting configuration - invalid file data"});return}if(c){if(!c.configurationVariables||c.configurationVariables.length===0){b.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:"Error exporting configuration - configuration data not present"});return}a.value||(a.value={createdBy:void 0,description:"",draft:!1,effectiveDate:new Date,version:-1,id:"",promoted:!1,variables:[]});const l=[];c.configurationVariables.forEach(y=>{l.push({name:y.name,type:y.type,value:ge(y.value,y.type)})}),a.value.variables=l,b.notify({color:"positive",position:"top",textColor:"secondary",message:"Configuration exported successfully"})}},ze=d=>{var c,l,y;if(t.value.length===0&&((c=a.value)==null?void 0:c.variables.length)===0)return!1;if(t.value.length===0&&((l=a.value)==null?void 0:l.variables.length)!==0)return!0;if(d=d||t.value.length-1,t.value.length>0){const W=t.value[d];if(W.variables.length!==((y=a.value)==null?void 0:y.variables.length)||W.variables.some(re=>{var se;const H=(se=a.value)==null?void 0:se.variables.find(we=>we.name===re.name);if(H){const we=H;if(we.constantVariable&&we.forced)return!1;if(H.type===P.LIST){const oe=ge(H.value,P.STRING),_e=ge(re.value,P.STRING);return H.type!==re.type||_e!==oe}else{if(H.type!==re.type)return!0;const oe=ge(H.value,H.type),_e=ge(re.value,re.type);return oe!==_e}}else return!0}))return!0}return!1},da=()=>{a.value&&(a.value.variables=t.value[R.value].variables)},ca=async()=>{if(a.value){t.value[R.value].promoted=!0;try{await ye.post(`/configurations/${t.value[R.value].id}/promote`)}catch{t.value[R.value].promoted=!1,b.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:"Error promoting configuration"})}}},va=()=>{if(Q.value&&$.value){let d=null;for(const c of $.value.values()){for(let l of c)if(l.id===v.value){d=l.configuration;break}if(d)break}d&&a.value&&(a.value.variables=[],d.variables.forEach(c=>{var l;(l=a.value)==null||l.variables.push({name:c.name,type:c.type,value:c.type!==P.LIST?c.value:[...c.value]})}))}},fa=async()=>{const d={};A.getBases.forEach(l=>{d[l.name]={$eq:null}}),w.configModel.forEach(l=>{l&&l.name!=="__NONE__"&&(d[l.base]=l.name)});const c=await ye.post("/configurations/promotionCandidates",d);c.status===200&&(Q.value=c.data)},ma=async()=>{Z.value=!0},ga=d=>{v.value===d?v.value="":v.value=d},ba=(d,c)=>{d.stopPropagation(),u.value=!0,C.value=c};return X(()=>w.configModel,B,{immediate:!1,deep:!0}),X(ce,d=>{console.log("isDifferent"),d&&!m.value?f.preventNavigation():f.allowNavigation()},{immediate:!0}),X(Q,d=>{n("update:promotionCandidates",d)}),U({importConfiguration:Ne,exportConfiguration:ua,importEnabled:V,userCanModify:F,showPromotionCandidatesDialog:ma}),(d,c)=>(o(),k(le,null,[s(Be,{modelValue:Z.value,"onUpdate:modelValue":c[0]||(c[0]=l=>Z.value=l),persistent:""},{default:g(()=>[s(Ve,{class:"tw-min-w-[30%]"},{default:g(()=>[s(pe,{class:"tw-bg-darkPage"},{default:g(()=>[Jt]),_:1}),r($)?(o(),I(pe,{key:0,class:"tw-max-h-[70vh] tw-overflow-auto"},{default:g(()=>[(o(!0),k(le,null,he(r($).keys(),l=>(o(),I(_t,{key:l,class:"tw-bg-darkPage","expand-separator":"",dense:"",label:l},{default:g(()=>[s(fe),s(Ra,{separator:""},{default:g(()=>[(o(!0),k(le,null,he(r($).get(l),y=>(o(),I(je,{clickable:"",active:v.value===y.id,key:y.id,"active-class":"tw-text-secondary tw-font-bold",onClick:W=>ga(y.id)},{default:g(()=>[s(ke,{avatar:""},{default:g(()=>[s(ve,{name:v.value===y.id?"sym_o_check":"sym_o_check_box_outline_blank",class:"heavy",color:v.value===y.id?"positive":void 0,size:"sm"},null,8,["name","color"])]),_:2},1024),s(ke,{class:"tw-flex-grow"},{default:g(()=>[q(" Version "+M(y.configuration.version)+", "+M(new Date(y.configuration.effectiveDate).toLocaleString()),1)]),_:2},1024),s(ke,{side:"",onClick:W=>ba(W,y.configuration)},{default:g(()=>[s(z,{flat:"",padding:"0.25rem"},{default:g(()=>[s(ve,{name:"sym_o_find_in_page",size:"sm"}),s(de,null,{default:g(()=>[q("Preview")]),_:1})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["active","onClick"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1})):h("",!0),s(De,{align:"right"},{default:g(()=>[xe(s(z,{color:"secondary",flat:"",label:"Cancel"},null,512),[[Ie]]),xe(s(z,{color:"positive",flat:"",label:"Promote",onClick:va,disable:!v.value},null,8,["disable"]),[[Ie]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(Be,{modelValue:u.value,"onUpdate:modelValue":c[1]||(c[1]=l=>u.value=l)},{default:g(()=>[s(Ve,{class:"tw-min-w-[30%]"},{default:g(()=>[s(pe,{class:"tw-bg-darkPage"},{default:g(()=>[S("div",Ht,"Preview "+M(r(i)),1)]),_:1}),s(pe,{class:"tw-max-w-[90vw] tw-max-h-[70vh] tw-overflow-auto"},{default:g(()=>[S("div",Xt,[(o(!0),k(le,null,he(C.value.variables,l=>(o(),k(le,{key:l.name},[S("div",Yt,M(l.name),1),S("div",Kt,M(l.value),1)],64))),128))])]),_:1}),s(De,{align:"right"},{default:g(()=>[xe(s(z,{color:"secondary",flat:"",label:"Close preview"},null,512),[[Ie]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(Ve,{class:"tw-bg-darkPage tw-text-secondary tw-gap-3 row tw-pt-2 tw-rounded tw-flex-1 tower-min-height",flat:""},{default:g(()=>[s(ta,{showing:m.value},{default:g(()=>[s(la,{color:"secondary",size:"3em"}),Zt]),_:1},8,["showing"]),r(ae).length===0&&!m.value&&!e.filter?(o(),k("div",el,[S("div",al,[q(" There aren't any variables in this configuration "),r(F)?(o(),k("div",tl," You can create one using panel below ")):h("",!0)])])):h("",!0),r(ae).length===0&&!m.value&&e.filter?(o(),k("div",ll,ol)):h("",!0),!m.value&&r(ae).length>0?(o(),k("div",rl,[S("div",{class:K([{"tw-grid-cols-5":t.value.length>0,"tw-grid-cols-2":t.value.length===0},"tw-grid tw-w-full tw-px-2 tw-gap-3 tw-justify-items-stretch tw-place-items-center tw-text-sm tw-font-semibold"])},[sl,t.value.length>0?(o(),k("div",il,[s(z,{disable:R.value<=0,class:"tw-flex-none",flat:"",icon:"sym_o_chevron_left",padding:"sm",onClick:c[2]||(c[2]=l=>R.value--)},null,8,["disable"]),S("div",ul,[S("div",dl,[s(z,{disable:r(N),flat:"",padding:"sm",onClick:ca},{default:g(()=>[s(ve,{class:K({filled:r(N)}),color:r(N)?"accent":void 0,name:"sym_o_star"},null,8,["class","color"]),r(ue)&&!r(N)?(o(),I(de,{key:0},{default:g(()=>[q("Promote")]),_:1})):h("",!0)]),_:1},8,["disable"]),s(fe,{inset:"",vertical:""})]),S("div",cl,[S("div",null," Version #"+M(R.value+1)+", created "+M(r(G)),1),S("div",vl,[q(" created by "),S("span",fl,M(r(ee)),1)])]),r(F)?(o(),k("div",ml,[s(fe,{inset:"",vertical:""}),s(z,{disable:!r(ue),flat:"",icon:"sym_o_undo",padding:"sm",onClick:da},{default:g(()=>[r(ue)?(o(),I(de,{key:0},{default:g(()=>[q("Revert to this version ")]),_:1})):h("",!0)]),_:1},8,["disable"])])):h("",!0)]),s(z,{disable:R.value>=t.value.length-1,class:"tw-flex-none",flat:"",icon:"sym_o_chevron_right",padding:"sm",onClick:c[3]||(c[3]=l=>R.value++)},null,8,["disable"])])):h("",!0),S("div",{class:K([{"tw-col-span-2":t.value.length>0},"tw-text-center tw-w-full"])}," Value ",2)],2),S("div",{class:K({"tw-col-span-2":t.value.length>0,"tower-max-height":r(F),"tower-max-height-readOnly":!r(F)})},[r(ae).length>=100?(o(!0),k(le,{key:0},he(r(ae),l=>(o(),I(oa,{key:l.name,class:"tower-configuration-row","ssr-prerender":""},{default:g(()=>[s(Je,{type:l.type,"onUpdate:type":y=>l.type=y,value:l.value,"onUpdate:value":y=>l.value=y,"allow-delete":!l.addIfAbsent,"current-archive":j(l.name),deleted:l.deleted,error:l.error,forced:l.forced||!r(F),grid:t.value.length>0?3:2,"is-constant-variable":l.constantVariable,name:l.name,showDiff:e.showDiff,onAddVariable:_,onRemoveVariable:L},null,8,["type","onUpdate:type","value","onUpdate:value","allow-delete","current-archive","deleted","error","forced","grid","is-constant-variable","name","showDiff"])]),_:2},1024))),128)):(o(),I(Na,{key:1,"enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"},{default:g(()=>[(o(!0),k(le,null,he(r(ae),l=>(o(),I(Je,{key:l.name,type:l.type,"onUpdate:type":y=>l.type=y,value:l.value,"onUpdate:value":y=>l.value=y,"allow-delete":!l.addIfAbsent,"current-archive":j(l.name),deleted:l.deleted,error:l.error,forced:l.forced||!r(F),grid:t.value.length>0?3:2,"is-constant-variable":l.constantVariable,name:l.name,showDiff:e.showDiff,onAddVariable:_,onRemoveVariable:L},null,8,["type","onUpdate:type","value","onUpdate:value","allow-delete","current-archive","deleted","error","forced","grid","is-constant-variable","name","showDiff"]))),128))]),_:1}))],2)])):h("",!0)]),_:1}),r(F)?(o(),k("div",gl,[s($e,{"enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"},{default:g(()=>[m.value?h("",!0):(o(),I(Gt,{key:0,"existing-variable-names":r(ie),onAddNewVariable:_},null,8,["existing-variable-names"]))]),_:1}),s($e,{"enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"},{default:g(()=>{var l;return[(l=a.value)!=null&&l.variables?(o(),I(sa,{key:0,"has-errors":O.value,"save-enabled":r(ce)&&!m.value,onSaveClicked:be},null,8,["has-errors","save-enabled"])):h("",!0)]}),_:1})])):h("",!0)],64))}});var wl=ia(bl,[["__scopeId","data-v-e261c3ae"]]),yl=function(e,U,n,w){var b=typeof w!="undefined"?[w,e]:[e],A=new Blob(b,{type:n||"application/octet-stream"});if(typeof window.navigator.msSaveBlob!="undefined")window.navigator.msSaveBlob(A,U);else{var T=window.URL&&window.URL.createObjectURL?window.URL.createObjectURL(A):window.webkitURL.createObjectURL(A),f=document.createElement("a");f.style.display="none",f.href=T,f.setAttribute("download",U),typeof f.download=="undefined"&&f.setAttribute("target","_blank"),document.body.appendChild(f),f.click(),setTimeout(function(){document.body.removeChild(f),window.URL.revokeObjectURL(T)},200)}};const hl={key:0,class:"tw-mt-3 tw-flex-1 tw-flex tw-flex-col"},ql=Ae({__name:"ConfigurationPage",setup(e){const U=qe(),n=E([]),w=E(""),b=E(null),A=E(null),T=E(!0),f=E([]),m=C=>{n.value=[...C]},a=()=>{let C=null,$="";b.value?($="constVariables",C=b.value.importConfiguration()):A.value&&($="configuration",C=A.value.importConfiguration()),C&&(Object.values(O.value).forEach(G=>{$+=`-${G}`}),$.length>=123&&($=$.substring(0,122)),$=`${$}.json`,yl(C,$))},t=C=>{b.value?b.value.exportConfiguration(C):A.value&&A.value.exportConfiguration(C)},x=()=>{A.value&&A.value.showPromotionCandidatesDialog()},p=C=>{f.value=C},O=D(()=>{if(!n.value)return{};const C={};return n.value.forEach($=>{$!=null&&$.base&&(C[$.base]=$.name)}),C}),R=D(()=>U.getBases),Q=D(()=>{if(!n.value||n.value.length===0)return!0;{let C=!1;return n.value.forEach($=>{$&&$.name!=="__NONE__"&&(C=!0)}),!C}}),Z=D(()=>{if(Q.value)return null;{let C=null;for(const $ of n.value)if($)C=$;else break;return C&&C.name==="__NONE__"?null:C}}),v=D(()=>b.value?b.value.importEnabled:A.value?A.value.importEnabled:!1),u=D(()=>b.value?b.value.userCanModify:A.value?A.value.userCanModify:!1);return(C,$)=>(o(),k("div",null,[s(Da,{"onUpdate:baseModels":m}),s($e,{"enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"},{default:g(()=>[!r(Q)&&r(Z)?(o(),I(Ba,{key:0,filter:w.value,"onUpdate:filter":$[0]||($[0]=G=>w.value=G),showDiff:T.value,"onUpdate:showDiff":$[1]||($[1]=G=>T.value=G),exportEnabled:r(u),importEnabled:r(v),title:r(R).length!==Object.keys(r(O)).length?"Constant variables":"Configuration",class:"tw-mt-3",onExportClicked:t,onImportClicked:a},{beforeImport:g(()=>[f.value.length>0&&r(R).length===Object.keys(r(O)).length&&r(Z)?(o(),I(z,{key:0,color:"transparent",flat:"",icon:"sym_o_stairs",padding:"sm","text-color":"secondary",onClick:x},{default:g(()=>[s(de,null,{default:g(()=>[q("Promotion candidates")]),_:1})]),_:1})):h("",!0)]),_:1},8,["filter","showDiff","exportEnabled","importEnabled","title"])):h("",!0)]),_:1}),s($e,{"enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"},{default:g(()=>[r(Q)?h("",!0):(o(),k("div",hl,[r(R).length!==Object.keys(r(O)).length&&r(Z)?(o(),I(At,{key:0,ref_key:"constVariablePanel",ref:b,"config-model":n.value,filter:w.value,showDiff:T.value},null,8,["config-model","filter","showDiff"])):r(Z)?(o(),I(wl,{key:1,ref_key:"configurationPanel",ref:A,"config-model":n.value,filter:w.value,showDiff:T.value,"onUpdate:promotionCandidates":p},null,8,["config-model","filter","showDiff"])):h("",!0)]))]),_:1})]))}});export{ql as default};
