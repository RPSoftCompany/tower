import{E as U,a3 as z,x as i,m as H,J as d,d as j,k as V,aa as m,a as s,w as u,aL as q,H as g,a9 as y,a7 as F,o as c,aG as K,aH as $,a5 as w,a8 as h,aI as M,aJ as D,Q as C,I as k,c as S,ac as T,ad as Y,aK as N}from"./index.d78f815c.js";import{b as I,Q as W}from"./QMenu.c8dbaa4e.js";import{Q as X}from"./QSelect.77d64708.js";import{Q as Z}from"./QList.7f34605a.js";import{_ as ee}from"./towerSelect.9436c179.js";import{_ as ae}from"./savePanel.faa1b35b.js";import{u as le}from"./use-quasar.6ef15f16.js";import{_ as te}from"./plugin-vue_export-helper.21dcd24c.js";import"./selection.faaa34c1.js";import"./use-key-composition.8fe7b499.js";import"./uid.42677368.js";import"./rtl.b51694b1.js";const oe={class:"tw-flex tw-flex-col tw-h-full"},se={class:"text-h6"},ue={class:"tw-h-full tw-flex tw-flex-col tw-items-center tw-overflow-auto"},re={key:0,class:"tw-mt-6 tower-min-height"},ne={key:1,class:"tw-justify-self-end"},ie=U({__name:"GroupsPage",setup(ve){const p=le(),x=z(),r=i([]),e=i(null),G=i([]),o=i([]),v=i(!1),n=i(""),_=i(!1);H(async()=>{await Q()});const Q=async()=>{const l={order:"name ASC"};let a=await d.get(`groups?filter=${JSON.stringify(l,void 0,"")}`);a.status===200&&(r.value=a.data),a=await d.get(`Roles?filter=${JSON.stringify(l,void 0,"")}`),a.status===200&&(G.value=a.data)},R=l=>{o.value.push(l),o.value=o.value.sort()},A=l=>{o.value=o.value.filter(a=>a!==l)},B=l=>{o.value.includes(l)?A(l):R(l)},J=async()=>{var l;if(v.value=!0,o.value&&e.value&&e.value._id){for(let a of o.value)((l=e.value)==null?void 0:l.roles.some(f=>f===a))||await d.post(`/groups/${e.value._id}/role?role=${a}`);for(let a of e.value.roles)o.value.some(f=>f===a)||await d.delete(`/groups/${e.value._id}/role?role=${a}`);e.value.roles=[...o.value]}else if(e.value&&!e.value._id){const a=await d.post("/groups",{name:e.value.name,roles:o.value});a.status===200&&(e.value=a.data)}p.notify({color:"positive",position:"top",textColor:"secondary",message:"Group data saved successfully"}),v.value=!1},L=()=>{r.value=r.value.filter(a=>!!a._id);let l={roles:[],name:n.value};r.value.push(l),e.value=l},O=async()=>{if(!!e.value){v.value=!0;try{await d.delete(`/groups/${e.value._id}`)}catch{p.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:"Error deleting group"});return}p.notify({color:"positive",position:"top",textColor:"secondary",message:"Group removed successfully"}),e.value=null,await Q(),v.value=!1}},P=()=>{_.value=!0},E=()=>{e.value&&!n.value?P():n.value&&L()},b=j(()=>e.value?!e.value._id||e.value.roles.length!==o.value.length?!0:e.value.roles.some(l=>!o.value.some(a=>a===l)):!1);return V(()=>e.value,l=>{r.value=r.value.filter(a=>!!a._id),l&&(o.value=[...l.roles])}),V(()=>b.value,l=>{l&&!v.value?x.preventNavigation():x.allowNavigation()}),(l,a)=>(c(),m("div",oe,[s(q,{modelValue:_.value,"onUpdate:modelValue":a[0]||(a[0]=t=>_.value=t)},{default:u(()=>[s(K,{class:"tw-min-w-[30%]"},{default:u(()=>[s($,{class:"tw-bg-negative"},{default:u(()=>{var t;return[g("div",se,"Delete "+w((t=e.value)==null?void 0:t.name),1)]}),_:1}),s($,null,{default:u(()=>{var t;return[h(" Are you sure you want to remove "),g("b",null,w((t=e.value)==null?void 0:t.name),1),h(" group? ")]}),_:1}),s(M,{align:"right"},{default:u(()=>[D(s(C,{color:"secondary",flat:"",label:"Cancel"},null,512),[[N]]),D(s(C,{color:"negative",flat:"",label:"Yes",onClick:O},null,512),[[N]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),g("div",ue,[s(ee,{label:"Group name",class:"tw-w-[33.3%]","option-label":"name",options:r.value,modelValue:e.value,"onUpdate:modelValue":a[1]||(a[1]=t=>e.value=t),filter:n.value,"onUpdate:filter":a[2]||(a[2]=t=>n.value=t)},{before:u(()=>[s(k,{name:"sym_o_group",size:"sm"})]),after:u(()=>[n.value||e.value?(c(),S(C,{key:0,flat:"",padding:"sm",onClick:E},{default:u(()=>[s(k,{name:e.value&&!n.value?"sym_o_delete":"sym_o_add"},null,8,["name"])]),_:1})):y("",!0)]),_:1},8,["options","modelValue","filter"])]),e.value?(c(),m("div",re,[s(Z,null,{default:u(()=>[(c(!0),m(T,null,Y(G.value,t=>(c(),S(W,{clickable:"",key:t.name,onClick:f=>B(t.name)},{default:u(()=>[s(I,{avatar:""},{default:u(()=>[s(k,{name:o.value.includes(t.name)?"sym_o_check":"sym_o_check_box_outline_blank",color:o.value.includes(t.name)?"positive":"grey-7",class:"heavy",size:"sm"},null,8,["name","color"])]),_:2},1024),s(I,null,{default:u(()=>[s(X,null,{default:u(()=>[h(w(t.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})])):y("",!0),e.value?(c(),m("div",ne,[s(ae,{"save-enabled":F(b),onSaveClicked:J,loading:v.value},null,8,["save-enabled","loading"])])):y("",!0)]))}});var xe=te(ie,[["__scopeId","data-v-37515891"]]);export{xe as default};
