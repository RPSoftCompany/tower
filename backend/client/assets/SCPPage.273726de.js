import{h as q,b as ge,$ as he,aY as Ue,a0 as ke,aZ as $e,x as y,d as I,I as D,C as Ae,f as ze,j as Ce,O as ve,b4 as fe,E as Me,ae as De,a3 as Ee,m as Oe,J as O,k as He,aa as H,a as u,w as g,aL as Le,H as h,a7 as T,c as W,a9 as M,ac as pe,ad as je,Q as B,D as ye,o as N,aG as Re,aH as we,a8 as oe,a5 as Ke,aI as Fe,aJ as _e,aK as be}from"./index.d78f815c.js";import{o as Je,c as Ge,Q as Ye}from"./QCheckbox.c616ffd9.js";import{a as Ze,h as We}from"./use-key-composition.8fe7b499.js";import{Q as Xe}from"./QToggle.d1194c03.js";import{Q as ea}from"./QSeparator.ac17e27e.js";import{_ as X}from"./towerSelect.9436c179.js";import{_ as aa}from"./savePanel.faa1b35b.js";import{Q as L}from"./QInput.72a273ff.js";import{u as ta}from"./use-quasar.6ef15f16.js";import"./uid.42677368.js";import"./QSelect.77d64708.js";import"./QMenu.c8dbaa4e.js";import"./selection.faaa34c1.js";import"./rtl.b51694b1.js";const oa=q("svg",{key:"svg",class:"q-radio__bg absolute non-selectable",viewBox:"0 0 24 24"},[q("path",{d:"M12,22a10,10 0 0 1 -10,-10a10,10 0 0 1 10,-10a10,10 0 0 1 10,10a10,10 0 0 1 -10,10m0,-22a12,12 0 0 0 -12,12a12,12 0 0 0 12,12a12,12 0 0 0 12,-12a12,12 0 0 0 -12,-12"}),q("path",{class:"q-radio__check",d:"M12,6a6,6 0 0 0 -6,6a6,6 0 0 0 6,6a6,6 0 0 0 6,-6a6,6 0 0 0 -6,-6"})]);var la=ge({name:"QRadio",props:{...he,...Ue,...Ze,modelValue:{required:!0},val:{required:!0},label:String,leftLabel:Boolean,checkedIcon:String,uncheckedIcon:String,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},emits:["update:modelValue"],setup(o,{slots:w,emit:C}){const{proxy:U}=Ce(),n=ke(o,U.$q),t=$e(o,Je),i=y(null),{refocusTargetEl:x,refocusTarget:P}=Ge(o,i),k=I(()=>fe(o.modelValue)===fe(o.val)),r=I(()=>"q-radio cursor-pointer no-outline row inline no-wrap items-center"+(o.disable===!0?" disabled":"")+(n.value===!0?" q-radio--dark":"")+(o.dense===!0?" q-radio--dense":"")+(o.leftLabel===!0?" reverse":"")),m=I(()=>{const d=o.color!==void 0&&(o.keepColor===!0||k.value===!0)?` text-${o.color}`:"";return`q-radio__inner relative-position q-radio__inner--${k.value===!0?"truthy":"falsy"}${d}`}),V=I(()=>(k.value===!0?o.checkedIcon:o.uncheckedIcon)||null),j=I(()=>o.disable===!0?-1:o.tabindex||0),R=I(()=>{const d={type:"radio"};return o.name!==void 0&&Object.assign(d,{".checked":k.value===!0,"^checked":k.value===!0?"checked":void 0,name:o.name,value:o.val}),d}),K=We(R);function $(d){d!==void 0&&(ve(d),P(d)),o.disable!==!0&&k.value!==!0&&C("update:modelValue",o.val,d)}function F(d){(d.keyCode===13||d.keyCode===32)&&ve(d)}function Y(d){(d.keyCode===13||d.keyCode===32)&&$(d)}return Object.assign(U,{set:$}),()=>{const d=V.value!==null?[q("div",{key:"icon",class:"q-radio__icon-container absolute-full flex flex-center no-wrap"},[q(D,{class:"q-radio__icon",name:V.value})])]:[oa];o.disable!==!0&&K(d,"unshift"," q-radio__native q-ma-none q-pa-none");const E=[q("div",{class:m.value,style:t.value,"aria-hidden":"true"},d)];x.value!==null&&E.push(x.value);const Z=o.label!==void 0?Ae(w.default,[o.label]):ze(w.default);return Z!==void 0&&E.push(q("div",{class:"q-radio__label q-anchor--skip"},Z)),q("div",{ref:i,class:r.value,tabindex:j.value,role:"radio","aria-label":o.label,"aria-checked":k.value===!0?"true":"false","aria-disabled":o.disable===!0?"true":void 0,onClick:$,onKeydown:F,onKeyup:Y},E)}}});const xe={radio:la,checkbox:Ye,toggle:Xe},na=Object.keys(xe);var sa=ge({name:"QOptionGroup",props:{...he,modelValue:{required:!0},options:{type:Array,validator:o=>o.every(w=>"value"in w&&"label"in w)},name:String,type:{default:"radio",validator:o=>na.includes(o)},color:String,keepColor:Boolean,dense:Boolean,size:String,leftLabel:Boolean,inline:Boolean,disable:Boolean},emits:["update:modelValue"],setup(o,{emit:w,slots:C}){const{proxy:{$q:U}}=Ce(),n=Array.isArray(o.modelValue);o.type==="radio"?n===!0&&console.error("q-option-group: model should not be array"):n===!1&&console.error("q-option-group: model should be array in your case");const t=ke(o,U),i=I(()=>xe[o.type]),x=I(()=>"q-option-group q-gutter-x-sm"+(o.inline===!0?" q-option-group--inline":"")),P=I(()=>{const r={role:"group"};return o.type==="radio"&&(r.role="radiogroup",o.disable===!0&&(r["aria-disabled"]="true")),r});function k(r){w("update:modelValue",r)}return()=>q("div",{class:x.value,...P.value},o.options.map((r,m)=>{const V=C["label-"+m]!==void 0?()=>C["label-"+m](r):C.label!==void 0?()=>C.label(r):void 0;return q("div",[q(i.value,{modelValue:o.modelValue,val:r.value,name:r.name===void 0?o.name:r.name,disable:o.disable||r.disable,label:V===void 0?r.label:null,leftLabel:r.leftLabel===void 0?o.leftLabel:r.leftLabel,color:r.color===void 0?o.color:r.color,checkedIcon:r.checkedIcon,uncheckedIcon:r.uncheckedIcon,dark:r.dark||t.value,size:r.size===void 0?o.size:r.size,dense:o.dense,keepColor:r.keepColor===void 0?o.keepColor:r.keepColor,"onUpdate:modelValue":k},V)])}))}});const ra={class:"tw-flex tw-flex-col tw-h-full"},ua=h("div",{class:"text-h6"},"Remove connection",-1),ia={key:0,class:"tw-italic"},da={class:"tw-flex tw-flex-col tw-items-center"},ca={key:0,class:"tw-mt-5 tw-flex tw-gap-3 tw-h-full"},ma={class:"tw-flex-grow"},va={class:"tw-flex"},fa=h("div",{class:"tw-mt-4 tw-mx-3"},":",-1),pa={class:"tw-rounded tw-mt-3 tw-border tw-border-dark tw-bg-dark"},ya={class:"tw-flex"},wa={class:"tw-flex-grow tw-mx-3 tw-self-center"},_a={class:"tw-flex tw-gap-3 tw-mt-3"},ba={class:"tw-w-[20rem]"},ga={class:"tw-flex tw-flex-col tw-py-3 tw-self-start tw-rounded tw-border tw-border-dark tw-bg-dark"},ha=h("div",{class:"tw-text-xl tw-font-medium tw-mx-3"},"Test connection",-1),ka=h("div",{class:"tw-text-gray-500 tw-mx-3"}," Test provided connection details ",-1),Ca={key:1},Ma=Me({__name:"SCPPage",setup(o){const w=ta(),C=De(),U=Ee(),n=y(null),t=y(null),i=y(null),x=y([]),P=y(new Map),k=y([]),r=y(!1),m=y(!1),V=y(null),j=y(null),R=y(null),K=y(null),$=y(null),F=y(!1);Oe(async()=>{await E(),await Ve(),await Z()});const Y=I(()=>{var s,a,l,e,c,v,_,S,f,p,b,A,J,le,ne,se,re,ue,ie,de,ce,me;if(n.value&&t.value){if(((s=n.value)==null?void 0:s.username)!==((a=t.value)==null?void 0:a.username)||((l=n.value)==null?void 0:l.host)!==((e=t.value)==null?void 0:e.host)||((c=n.value)==null?void 0:c.port)!==((v=t.value)==null?void 0:v.port)||((_=n.value)==null?void 0:_.authType)!==((S=t.value)==null?void 0:S.authType))return!0;if(((f=t.value)==null?void 0:f.authType)==="key"){if(n.value.key!==((p=t.value)==null?void 0:p.key))return!0}else if(((b=n.value)==null?void 0:b.password)!==((A=t.value)==null?void 0:A.password))return!0;if(((J=n.value)==null?void 0:J.items.length)!==((le=t.value)==null?void 0:le.items.length))return!0;for(let G=0;G<((ne=n.value)==null?void 0:ne.items.length);G++)if((se=t.value)!=null&&se.items[G]){const Q=(re=n.value)==null?void 0:re.items[G],z=(ue=t.value)==null?void 0:ue.items[G];for(const te in Q)if(te==="template"){if(((ie=Q==null?void 0:Q.template)==null?void 0:ie.id)!==((de=z==null?void 0:z.template)==null?void 0:de.id)||((ce=Q==null?void 0:Q.template)==null?void 0:ce.url)!==((me=z==null?void 0:z.template)==null?void 0:me.url))return!0}else if(Q[te]!==z[te])return!0}else return!0}return!1}),d=I(()=>{var s,a,l,e,c,v,_;if(t.value){if(!((s=t.value)!=null&&s.username))return"Username can't be empty";if(!((a=t.value)!=null&&a.host))return"Host can't be empty";if(((l=t.value)==null?void 0:l.authType)==="key"&&!((e=t.value)!=null&&e.key))return"SSH key can't be empty";if(((c=t.value)==null?void 0:c.authType)==="userpass"&&!((v=t.value)!=null&&v.password))return"Password can't be empty";for(const f of(_=t.value)==null?void 0:_.items){for(const p of C.getBases)if(!f[p.name])return`${p.name} in one of your connection items is invalid`;if(!f.template)return"Template in one of your connection items is invalid";if(!f.path)return"Path in one of your connection items is invalid"}let S=null;if(t.value._id?S=x.value.find(f=>{var p,b,A;return f._id!==((p=t.value)==null?void 0:p._id)&&f.host===((b=t.value)==null?void 0:b.host)&&f.username===((A=t.value)==null?void 0:A.username)}):S=x.value.find(f=>{var p,b;return f.host===((p=t.value)==null?void 0:p.host)&&f.username===((b=t.value)==null?void 0:b.username)}),S)return"Connection with this username and host exists already"}return""}),E=async()=>{const s={where:{system:"SCP"}};m.value=!0;const a=await O.get(`/connections?filter=${JSON.stringify(s,void 0,"")}`);a.status===200&&(x.value=[],a.data.forEach(l=>{const e=[];l.items.forEach(c=>{let v=c;v.__name__=ee(c),e.push(v)}),x.value.push({_id:l._id,enabled:!0,authType:l.authType,host:l.host,items:e,key:l.key,port:l.port,password:l.password,system:l.system,username:l.username,connectionName:`${l.username}@${l.host}`})})),m.value=!1},Z=async()=>{m.value=!0;const s=await O.get("/restConfigurations");s.status===200&&(k.value=s.data),m.value=!1},Ve=async()=>{m.value=!0;const s={order:"name ASC"},a=await O.get(`/configurationModels?filter=${JSON.stringify(s,void 0,"")}`);a.status===200&&a.data.forEach(l=>{var e;P.value.has(l.base)?(e=P.value.get(l.base))==null||e.push(l.name):P.value.set(l.base,[l.name])}),m.value=!1},ee=s=>{let a="";for(const l of C.getBases)a&&s[l.name]&&(a+="/"),s[l.name]&&(a+=`${s[l.name]}`);return a},Se=()=>{ye(()=>{V.value?V.value.validate():j.value&&j.value.validate()})},Te=()=>{i.value&&(i.value.__name__=ee(i.value))},Ie=()=>{if(t.value){i.value={template:null,path:""};for(const s of C.getBases)i.value[s.name]=null;i.value.__name__="New Connection item",t.value.items.push(i.value)}},qe=()=>{t.value&&(t.value.items=t.value.items.filter(s=>{for(const a in i.value)if(i.value[a]!==s[a])return!0;return!1}),i.value=null)},ae=()=>{var s,a,l,e,c,v,_,S;if(i.value=null,n.value){const f=[];(s=n.value)==null||s.items.forEach(p=>{const b={path:p.path,template:p.template},A=Object.getOwnPropertyNames(p);for(const J of A)b[J]=p[J];b.__name__=ee(b),f.push(b)}),t.value={_id:n.value._id,enabled:!0,username:n.value.username,key:(a=n.value)==null?void 0:a.key,port:(l=n.value)==null?void 0:l.port,password:(e=n.value)==null?void 0:e.password,authType:(c=n.value)==null?void 0:c.authType,items:f,connectionName:(v=t.value)==null?void 0:v.connectionName,host:(_=n.value)==null?void 0:_.host,system:(S=n.value)==null?void 0:S.system}}else t.value=null},Ne=async()=>{var s;try{(s=n.value)!=null&&s._id&&(await O.delete(`/connections/${n.value._id}`)).status===204&&(w.notify({color:"positive",position:"top",textColor:"secondary",message:"Connection removed successfully"}),n.value=null,t.value=null)}catch{w.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:"Error deleting connection"})}},Pe=()=>{n.value={system:"SCP",enabled:!0,key:"",username:"",host:"",port:22,items:[],password:"",connectionName:"New connection",authType:"key"},ae(),ye(()=>{R.value&&R.value.validate(),K.value&&K.value.validate(),$.value&&$.value.validate(),V.value&&V.value.validate()})},Qe=async()=>{var s;if(t.value){m.value=!0,(s=t.value)==null||s.items.map(a=>{var l,e;return a.template&&(a.template={id:(l=a.template)==null?void 0:l.id,url:(e=a.template)==null?void 0:e.url}),a});try{if((await O.patch("/connections",t.value)).status===200){await E();const l=x.value.find(e=>{var c,v;return e.host===((c=t.value)==null?void 0:c.host)&&e.username===((v=t.value)==null?void 0:v.username)});l&&(n.value=l,ae()),w.notify({color:"positive",position:"top",textColor:"secondary",message:"Connection saved successfully"})}}catch{w.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:"Error saving connection"})}m.value=!1}},Be=async()=>{var s,a,l,e,c,v;try{m.value=!0,(await O.post("/connections/testConnection?type=SCP",t.value)).status===204&&w.notify({color:"positive",position:"top",textColor:"secondary",message:"Connection established successfully"})}catch(_){const S=(l=(a=(s=_.response)==null?void 0:s.data)==null?void 0:a.error)!=null&&l.message?(v=(c=(e=_.response)==null?void 0:e.data)==null?void 0:c.error)==null?void 0:v.message:_.message;w.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:S})}m.value=!1};return He(()=>Y.value,s=>{s&&!m.value?U.preventNavigation():U.allowNavigation()}),(s,a)=>{var l;return N(),H("div",ra,[u(Le,{modelValue:F.value,"onUpdate:modelValue":a[0]||(a[0]=e=>F.value=e),persistent:""},{default:g(()=>[u(Re,{class:"tw-min-w-[30%]"},{default:g(()=>[u(we,{class:"tw-bg-negative"},{default:g(()=>[ua]),_:1}),u(we,null,{default:g(()=>[oe(" Are you sure you want to remove "),n.value?(N(),H("span",ia,Ke(n.value.connectionName),1)):M("",!0),oe(" connection? ")]),_:1}),u(Fe,{align:"right"},{default:g(()=>[_e(u(B,{color:"secondary",flat:"",label:"Cancel"},null,512),[[be]]),_e(u(B,{color:"negative",flat:"",label:"Yes",onClick:Ne},null,512),[[be]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),h("div",da,[u(X,{modelValue:n.value,"onUpdate:modelValue":[a[2]||(a[2]=e=>n.value=e),ae],loading:m.value,options:x.value,class:"tw-w-[33.3%]",label:"Connection","option-label":"connectionName"},{after:g(()=>[u(B,{flat:"",padding:"sm",onClick:Pe},{default:g(()=>[u(D,{name:"sym_o_add"})]),_:1}),n.value&&n.value.connectionName!=="New connection"?(N(),W(B,{key:0,flat:"",padding:"sm",onClick:a[1]||(a[1]=e=>F.value=!0)},{default:g(()=>[u(D,{name:"sym_o_delete"})]),_:1})):M("",!0)]),_:1},8,["modelValue","loading","options"])]),t.value?(N(),H("div",ca,[h("div",ma,[h("div",va,[u(T(L),{modelValue:t.value.username,"onUpdate:modelValue":a[3]||(a[3]=e=>t.value.username=e),ref_key:"usernameInput",ref:R,label:"Username",dense:"",color:"secondary",class:"tw-flex-grow",rules:[e=>!!e||"Username can't be empty"]},null,8,["modelValue","rules"]),u(D,{name:"sym_o_alternate_email",size:"sm",class:"tw-mt-4 tw-mx-1.5"}),u(T(L),{modelValue:t.value.host,"onUpdate:modelValue":a[4]||(a[4]=e=>t.value.host=e),ref_key:"hostInput",ref:K,label:"Host",color:"secondary",dense:"",class:"tw-flex-grow",rules:[e=>!!e||"Host can't be empty"]},null,8,["modelValue","rules"]),fa,u(T(L),{modelValue:t.value.port,"onUpdate:modelValue":a[5]||(a[5]=e=>t.value.port=e),ref_key:"portInput",ref:$,label:"Port",color:"secondary",dense:"",class:"tw-flex-grow",rules:[e=>!!e||"Port can't be empty"]},null,8,["modelValue","rules"])]),h("div",pa,[h("div",ya,[u(sa,{modelValue:t.value.authType,"onUpdate:modelValue":[a[6]||(a[6]=e=>t.value.authType=e),Se],color:"secondary",options:[{label:"SSH key",value:"key"},{label:"Password",value:"userpass"}]},null,8,["modelValue"]),h("div",wa,[t.value.authType==="key"?(N(),W(T(L),{key:0,ref_key:"sshKeyInput",ref:V,modelValue:t.value.key,"onUpdate:modelValue":a[7]||(a[7]=e=>t.value.key=e),rules:[e=>!!e||"SSH key can't be empty"],color:"secondary",dense:"",label:"SSH key"},null,8,["modelValue","rules"])):M("",!0),((l=t.value)==null?void 0:l.authType)==="userpass"?(N(),W(T(L),{key:1,ref_key:"passwordInput",ref:j,rules:[e=>!!e||"Password can't be empty"],color:"secondary",modelValue:t.value.password,"onUpdate:modelValue":a[9]||(a[9]=e=>t.value.password=e),dense:"",type:r.value?"text":"password",label:"Password"},{append:g(()=>[u(B,{icon:r.value?"sym_o_lock":"sym_o_lock_open",flat:"",padding:"sm",onClick:a[8]||(a[8]=e=>r.value=!r.value)},null,8,["icon"])]),_:1},8,["rules","modelValue","type"])):M("",!0)])])]),u(X,{modelValue:i.value,"onUpdate:modelValue":a[10]||(a[10]=e=>i.value=e),options:t.value.items,label:"Connection item",class:"tw-mt-3","option-label":"__name__"},{after:g(()=>[u(B,{flat:"",padding:"sm",onClick:Ie},{default:g(()=>[u(D,{name:"sym_o_add"})]),_:1}),u(B,{flat:"",padding:"sm",onClick:qe},{default:g(()=>[u(D,{name:"sym_o_delete"})]),_:1})]),_:1},8,["modelValue","options"]),i.value?(N(),H(pe,{key:0},[h("div",_a,[(N(!0),H(pe,null,je(T(C).getBases,e=>(N(),W(X,{key:e._id,label:e.name,options:P.value.get(e.name),"option-label":"name",class:"tw-flex-grow",rules:[c=>!!c||`${e.name} can't be empty`],modelValue:i.value[e.name],"onUpdate:modelValue":[c=>i.value[e.name]=c,Te]},null,8,["label","options","rules","modelValue","onUpdate:modelValue"]))),128))]),u(X,{modelValue:i.value.template,"onUpdate:modelValue":a[11]||(a[11]=e=>i.value.template=e),options:k.value,label:"Template","option-label":"url",rules:[e=>!!e||"Template can't be empty"]},null,8,["modelValue","options","rules"]),u(T(L),{modelValue:i.value.path,"onUpdate:modelValue":a[12]||(a[12]=e=>i.value.path=e),dense:"",label:"Path on server",color:"secondary",rules:[e=>!!e||"Path can't be empty"]},null,8,["modelValue","rules"])],64)):M("",!0)]),h("div",ba,[h("div",ga,[ha,ka,u(ea,{spaced:"",class:"tw-bg-darkPage tw-mx-[-1px]"}),u(B,{class:"tw-bg-secondary tw-mx-3 tw-flex-grow",flat:"","text-color":"primary",disable:!!T(d),onClick:Be},{default:g(()=>[u(D,{class:"tw-mr-3",color:"primary",name:"sym_o_cable",size:"sm"}),oe(" Test connection ")]),_:1},8,["disable"])])])])):M("",!0),t.value?(N(),H("div",Ca,[u(aa,{"save-enabled":T(Y),"has-errors":!!T(d),"error-text":T(d),onSaveClicked:Qe},null,8,["save-enabled","has-errors","error-text"])])):M("",!0)])}}});export{Ma as default};
