import{E as V,ae as N,a3 as B,x as c,m as E,d as I,J as m,k as A,aa as p,H as _,a as i,a7 as h,w as v,a9 as P,o as d,ac as J,ad as L,c as O,I as D,a8 as j,a5 as q}from"./index.d78f815c.js";import{b,Q as z}from"./QMenu.c8dbaa4e.js";import{Q as F}from"./QSelect.77d64708.js";import{Q as H}from"./QList.7f34605a.js";import{_ as T}from"./towerSelect.9436c179.js";import{_ as U}from"./savePanel.faa1b35b.js";import{u as G}from"./use-quasar.6ef15f16.js";import"./selection.faaa34c1.js";import"./use-key-composition.8fe7b499.js";import"./uid.42677368.js";import"./rtl.b51694b1.js";const K={class:"tw-flex tw-flex-col tw-h-full"},W={class:"tw-flex tw-flex-col tw-items-center"},X={key:0,class:"tw-flex tw-flex-col tw-h-full tw-mt-6"},Y=_("div",{class:"tw-flex-grow"},null,-1),Z={class:"tw-justify-self-end"},fe=V({__name:"PermissionsPage",setup(ee){const g=G(),k=N(),w=B(),r=c([]),s=c(null),f=c([]),o=c([]),n=c(!1);E(async()=>{await x()});const y=I(()=>r.value.length!==o.value.length?!0:r.value.some(a=>!o.value.some(t=>t===a.name))),x=async()=>{n.value=!0;const a={where:{name:{like:"^configurationModel."}}},t=await m.get(`Roles?filter=${JSON.stringify(a,void 0,"")}`);if(t.status===200){const e=new RegExp("^configurationModel.\\S+.(view|modify)$");o.value=[],r.value=t.data.filter(l=>e.test(l.name)?(o.value.push(l.name),!0):!1)}n.value=!1},C=async()=>{var e;if(f.value=[],!s.value)return;n.value=!0;const a={where:{base:(e=s.value)==null?void 0:e.name},order:"name ASC"},t=await m.get(`configurationModels?filter=${JSON.stringify(a,void 0,"")}`);t.status===200&&(f.value=t.data),n.value=!1},M=a=>{var t,e,l,u,$;if(o.value.includes(`configurationModel.${(t=s.value)==null?void 0:t.name}.${a}.view`)){const Q=new RegExp(`^(configurationModel|constantVariable).${(e=s.value)==null?void 0:e.name}.${a}.(view|modify)$`);o.value=o.value.filter(R=>!Q.test(R))}else o.value.push(`configurationModel.${(l=s.value)==null?void 0:l.name}.${a}.view`),o.value.push(`configurationModel.${(u=s.value)==null?void 0:u.name}.${a}.modify`),o.value.push(`constantVariable.${($=s.value)==null?void 0:$.name}.${a}.modify`)},S=async()=>{n.value=!0;for(const a of o.value)if(!r.value.some(e=>e.name===a))try{await m.post("/Roles",{name:a})}catch{g.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:"Error saving permissions"})}for(const a of r.value)if(!o.value.some(e=>e===a.name))try{await m.delete(`/Roles/${a.id}`)}catch{g.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:"Error saving permissions"})}g.notify({color:"positive",position:"top",textColor:"secondary",message:"Configuration saved successfully"}),await x(),n.value=!1};return A(()=>y.value,a=>{a&&!n.value?w.preventNavigation():w.allowNavigation()}),(a,t)=>(d(),p("div",K,[_("div",W,[i(T,{modelValue:s.value,"onUpdate:modelValue":[t[0]||(t[0]=e=>s.value=e),C],label:"Base",options:h(k).getBases,"option-label":"name",class:"tw-w-[33.3%]",loading:n.value},null,8,["modelValue","options","loading"])]),f.value.length>0?(d(),p("div",X,[i(H,null,{default:v(()=>[(d(!0),p(J,null,L(f.value,e=>(d(),O(z,{key:e.name,clickable:"",onClick:l=>M(e.name),disable:n.value},{default:v(()=>[i(b,{avatar:""},{default:v(()=>{var l,u;return[i(D,{name:o.value.includes(`configurationModel.${(l=s.value)==null?void 0:l.name}.${e.name}.view`)?"sym_o_check":"sym_o_check_box_outline_blank",color:o.value.includes(`configurationModel.${(u=s.value)==null?void 0:u.name}.${e.name}.view`)?"positive":"grey-7",class:"heavy",size:"sm"},null,8,["name","color"])]}),_:2},1024),i(b,null,{default:v(()=>[i(F,null,{default:v(()=>[j(q(e.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick","disable"]))),128))]),_:1}),Y,_("div",Z,[i(U,{"save-enabled":h(y),onSaveClicked:S,loading:n.value},null,8,["save-enabled","loading"])])])):P("",!0)]))}});export{fe as default};
