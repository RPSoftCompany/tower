import{Q as g,a as y,b as _}from"./QPage.23dc3a3e.js";import{Q as m}from"./QInput.72a273ff.js";import{E as v,x as u,F as b,m as h,c as x,w as i,G as Q,o as U,H as c,a as t,Q as V,I as P,J as w}from"./index.d78f815c.js";import{u as C}from"./use-quasar.6ef15f16.js";import{i as I}from"./index.d709224d.js";import{A as k}from"./index.dd8b4ad7.js";import"./use-key-composition.8fe7b499.js";import"./uid.42677368.js";const A={class:"tw-grid tw-grid-cols-1 tw-gap-1 tw-w-1/5 tw-justify-items-center animate__animated animate__bounce"},B=c("div",null,"Login",-1),N=v({__name:"LoginPage",setup(j){const p=C(),d=Q(),o=u(null),r=u(null),n=u(!1),l=b();h(()=>{l&&l.$reset()});const f=async()=>{try{n.value=!0;const e=await w.post("/members/login?include=user",{username:o.value,password:r.value});if(e.status===200&&e.data&&e.data.user.newUser){l.setUserDetails(e.data.id,e.data.user.display?e.data.user.display:e.data.user.username,[],e.data.user.type==="ldap"),await d.push({name:"ChangePassword"});return}if(e.status===200&&e.data){const a=await w.get("/members/getUserRoles",{headers:{Authorization:e.data.id}});a.status===200&&a.data&&l.setUserDetails(e.data.id,e.data.user.display?e.data.user.display:e.data.user.username,a.data,e.data.user.type==="ldap")}}catch(e){let a="Invalid username or password";e instanceof k&&e.response&&e.response.status&&e.response.status===403&&(a="User is blocked"),p.notify({color:"negative",position:"top",textColor:"secondary",icon:I,message:a});return}await d.push({name:"Configuration"}),n.value=!1};return(e,a)=>(U(),x(g,{class:"row items-center justify-evenly"},{default:i(()=>[c("div",A,[t(y,{alt:"Tower configuration server logo",class:"tw-h-40 tw-w-40 tw-mb-10 tw-min-w-[10rem]","spinner-color":"secondary",src:"img/tower.png"}),t(_,{autofocus:"",class:"tw-w-full tw-grid tw-grid-cols-1 tw-gap-1 tw-justify-items-center",greedy:"",onSubmit:f},{default:i(()=>[t(m,{modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=s=>o.value=s),rules:[s=>s&&s.length>0||"Please type your username"],class:"tw-w-full tw-min-w-[10rem] tw-max-w-[25rem]",color:"secondary",label:"Username",autocomplete:"towerUsername","lazy-rules":""},null,8,["modelValue","rules"]),t(m,{modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=s=>r.value=s),rules:[s=>s&&s.length>0||"Please type your password"],class:"tw-w-full tw-min-w-[10rem] tw-max-w-[25rem]",color:"secondary",label:"Password","lazy-rules":"",type:"password",autocomplete:"towerPassword"},null,8,["modelValue","rules"]),t(V,{disable:!o.value||!r.value,loading:n.value,class:"tw-mt-5 tw-bg-secondary",flat:"","text-color":"primary",type:"submit"},{default:i(()=>[t(P,{class:"tw-mr-3",color:"dark",name:"sym_o_login"}),B]),_:1},8,["disable","loading"])]),_:1})])]),_:1}))}});export{N as default};
