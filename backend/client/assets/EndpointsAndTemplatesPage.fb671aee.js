import{E as re,ae as ue,a3 as ie,x as d,m as de,J as x,d as V,k as B,aa as S,a as l,w as n,aL as z,H as u,a7 as g,a9 as R,o as w,aG as A,aH as k,a5 as _,a8 as U,aI as j,aJ as q,Q as c,ac as ve,ad as ce,c as J,I as y,a4 as fe,aT as me,aU as pe,D as I,aK as T}from"./index.d78f815c.js";import{a as ge,Q as we}from"./QSelect.77d64708.js";import{Q as _e,b as ye}from"./QMenu.c8dbaa4e.js";import{Q as be}from"./QSeparator.ac17e27e.js";import{_ as he}from"./towerSelect.9436c179.js";import{a as N,m as Ce,t as xe,s as ke,V as Ee}from"./ext-language_tools.ac726293.js";import{_ as Ve}from"./savePanel.faa1b35b.js";import{Q as Se}from"./QInput.72a273ff.js";import{u as Ue}from"./use-quasar.6ef15f16.js";import"./use-key-composition.8fe7b499.js";import"./uid.42677368.js";import"./rtl.b51694b1.js";import"./selection.faaa34c1.js";const qe={class:"text-h6"},Te=u("div",{class:"text-h6"},"Change endpoint sequence",-1),Ne={class:"tw-flex tw-items-center"},Qe={class:"tw-flex tw-justify-center"},De={key:0,class:"tw-mt-3"},$e={class:"tw-flex tw-mt-2"},Be={class:"tw-flex-grow"},Re={class:"tw-mr-3 tw-p-1 tw-bg-dark tw-rounded"},Ae={class:"tw-flex tw-flex-col tw-py-3 tw-self-start tw-rounded tw-border tw-border-dark tw-bg-dark"},Ie=u("div",{class:"tw-text-xl tw-font-medium tw-mx-3"},"Return type",-1),Le=u("div",{class:"tw-text-gray-500 tw-mx-3"}," Determines the REST API contentType ",-1),Pe={key:1,class:"tw-mt-3"},aa=re({__name:"EndpointsAndTemplatesPage",setup(Me){const f=Ue(),Q=ue(),L=ie(),s=d(null),r=d(null),b=d([]),o=d([]),i=d(!1),m=d([]),h=d(null),D=d(!1),$=d(!1),C=d("-1");de(async()=>{N.config.setModuleUrl("ace/mode/liquid",Ce),N.config.setModuleUrl("ace/theme/monokai",xe),N.config.setModuleUrl("ace/snippets/liquid",ke),N.require("ace/ext/language_tools"),m.value.push(F),m.value.push(G),m.value.push(W),m.value.push(K),await E()});const E=async()=>{const e={order:"sequenceNumber ASC"},t=await x.get(`/restConfigurations?filter=${JSON.stringify(e,void 0,"")}`);t.status===200&&(b.value=[...t.data],o.value=[...t.data])},O=async()=>{if(s.value){i.value=!0;try{s.value.id?await x.patch(`/restConfigurations/${s.value.id}`,s.value):await x.post("/restConfigurations",s.value)}catch{f.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:"Error saving endpoint details"}),i.value=!1;return}await E();const e=b.value.find(t=>{var a;return t.url===((a=s.value)==null?void 0:a.url)});e&&(r.value=e),f.notify({color:"positive",position:"top",textColor:"secondary",message:"Configuration saved successfully"}),i.value=!1}},H=()=>{r.value=null,I(()=>{s.value={url:"",returnType:"json",sequenceNumber:b.value.length,template:`{
	{%- for var in variables -%}
	{% case var.type -%}
	{% when "string", "password" %}
	"{{ var.name }}":"{{ var.value }}"{%- if forloop.last != true -%},{%- endif -%}
	{% when "number", "boolean" %}
	"{{ var.name }}":{{ var.value }}{%- if forloop.last != true -%},{%- endif -%}
	{% when "list" %}
	"{{ var.name }}":[{% for listVar in var -%}"{{ listVar }}"{%- if forloop.last != true -%},{%- endif -%}{%- endfor -%}{%- if forloop.last != true -%}],{%- endif -%}
	{% else %}
	"{{ var.name }}":"{{ var.value }}"{%- if forloop.last != true -%},{%- endif -%}
	{% endcase -%}
	{%- endfor %}
}`},I(()=>{h.value&&h.value.validate()})})},F=()=>b.value.some(t=>{if(s.value)return t.id!==s.value.id&&t.url===s.value.url})?"Endpoint with such URL exists already":!0,G=e=>e?!0:"URL can't be empty",K=e=>e.includes("}{")?"Base Models can't be next to each other":!0,W=e=>{let t=!1;return e&&(t=Q.getBases.some(a=>e.includes(`{${a.name}}`))),t?!0:"At least one Base Model needs to be used in URL"},Y=async()=>{if(r.value){try{await x.delete(`/restConfigurations/${r.value.id}`)}catch{f.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:"Error deleting endpoint"});return}await E(),r.value=null,f.notify({color:"positive",position:"top",textColor:"secondary",message:"Endpoint deleted successfully"})}},X=e=>{e&&setTimeout(()=>{C.value=e},10)},Z=()=>{C.value=""},ee=e=>{if(o.value[e].id!==C.value){const t=o.value.findIndex(a=>a.id===C.value);if(t>=0){const a=o.value[e];o.value[e]=o.value[t],o.value[t]=a}}},ae=e=>{if(e>0){const t=o.value[e-1],a=o.value[e];t&&a&&(o.value[e-1]=a,o.value[e]=t)}},te=e=>{if(e<o.value.length){const t=o.value[e],a=o.value[e+1];t&&a&&(o.value[e]=a,o.value[e+1]=t)}},le=async()=>{i.value=!0;for(let e=0;e<o.value.length;e++)if(o.value[e].sequenceNumber!==e)try{o.value[e].sequenceNumber=e,await x.patch(`/restConfigurations/${o.value[e].id}`,o.value[e])}catch{f.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:"Error updating REST Configuration sequences"}),i.value=!1;return}await E(),f.notify({color:"positive",position:"top",textColor:"secondary",message:"REST Configuration sequences saved successfully"}),i.value=!1},P=V(()=>{var e,t,a,v,p,M;return s.value&&r.value?s.value.returnType!==((e=r.value)==null?void 0:e.returnType)||((t=s.value)==null?void 0:t.template)!==((a=r.value)==null?void 0:a.template)||s.value.url!==((v=r.value)==null?void 0:v.url)||((p=s.value)==null?void 0:p.sequenceNumber)!==((M=r.value)==null?void 0:M.sequenceNumber):!r.value}),se=V(()=>{for(let e=0;e<o.value.length;e++)if(o.value[e].sequenceNumber!==e)return!0;return!1}),oe=V(()=>{let e="";return Q.getBases.forEach((t,a)=>{e+=`{${t.name}}`,a!==Q.getBases.length-1&&(e+="/")}),e}),ne=V(()=>s.value?m.value.some(e=>!!(s.value&&e(s.value.url)!==!0)):!1);return B(()=>r.value,e=>{e?s.value={id:e.id,returnType:e.returnType,template:e.template,sequenceNumber:e.sequenceNumber,url:e.url}:s.value=null}),B(()=>s.value,e=>{e&&I(()=>{h.value&&h.value.validate()})},{deep:!0}),B(()=>P.value,e=>{e&&!i.value?L.preventNavigation():L.allowNavigation()}),(e,t)=>(w(),S("div",null,[l(z,{modelValue:D.value,"onUpdate:modelValue":t[0]||(t[0]=a=>D.value=a),persistent:""},{default:n(()=>[l(A,{class:"tw-min-w-[30%]"},{default:n(()=>[l(k,{class:"tw-bg-negative"},{default:n(()=>{var a;return[u("div",qe,"Delete "+_((a=r.value)==null?void 0:a.url),1)]}),_:1}),l(k,null,{default:n(()=>{var a;return[U(" Are you sure you want to remove "),u("b",null,_((a=r.value)==null?void 0:a.url),1),U(" endpoint? ")]}),_:1}),l(j,{align:"right"},{default:n(()=>[q(l(c,{color:"secondary",flat:"",label:"Cancel"},null,512),[[T]]),q(l(c,{color:"negative",flat:"",label:"Yes",onClick:Y},null,512),[[T]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(z,{modelValue:$.value,"onUpdate:modelValue":t[1]||(t[1]=a=>$.value=a),persistent:""},{default:n(()=>[l(A,{class:"tw-min-w-[30%]"},{default:n(()=>[l(k,{class:"tw-bg-darkPage"},{default:n(()=>[Te]),_:1}),l(k,null,{default:n(()=>[(w(!0),S(ve,null,ce(o.value,(a,v)=>(w(),J(A,{bordered:"",flat:"",key:a.id,draggable:"true",class:fe(["tw-bg-darkPage",{"tw-opacity-20":C.value===a.id}]),onDragstart:p=>X(a.id),onDragenter:p=>ee(v),onDragend:Z},{default:n(()=>[l(k,{class:"tw-flex tw-justify-between"},{default:n(()=>[u("div",Ne,[l(y,{name:"sym_o_drag_indicator",class:"tw-mr-3 tw-cursor-grab",size:"sm"}),u("span",null,[u("b",null,_(v+1)+".",1),U(" /v1/"),u("b",null,_(a.url),1)])]),u("div",null,[l(c,{flat:"",padding:"0.25rem",disable:v===0,onClick:p=>ae(v)},{default:n(()=>[l(y,{name:"sym_o_keyboard_arrow_up",size:"sm"})]),_:2},1032,["disable","onClick"]),l(c,{flat:"",padding:"0.25rem",disabled:v>=o.value.length-1,onClick:p=>te(v)},{default:n(()=>[l(y,{name:"sym_o_keyboard_arrow_down",size:"sm"})]),_:2},1032,["disabled","onClick"])])]),_:2},1024)]),_:2},1032,["class","onDragstart","onDragenter"]))),128))]),_:1}),l(j,{align:"right"},{default:n(()=>[q(l(c,{color:"secondary",flat:"",label:"Cancel"},null,512),[[T]]),q(l(c,{color:"secondary",disable:!g(se),flat:"",label:"Update",onClick:le},null,8,["disable"]),[[T]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),u("div",Qe,[l(he,{modelValue:r.value,"onUpdate:modelValue":t[4]||(t[4]=a=>r.value=a),options:b.value,"option-label":"url",class:"tw-w-[33.3%]",label:"Endpoint",loading:i.value,disable:i.value},{option:n(a=>[l(_e,me(pe(a.itemProps)),{default:n(()=>[l(ye,null,{default:n(()=>[l(we,null,{default:n(()=>[u("b",null,_(a.opt.sequenceNumber+1)+".",1),U(" v1/"+_(a.opt.url),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),after:n(()=>[l(c,{flat:"",padding:"0.25rem",onClick:H,loading:i.value,disable:i.value},{default:n(()=>[l(y,{name:"sym_o_add",size:"sm"})]),_:1},8,["loading","disable"]),r.value?(w(),J(c,{key:0,flat:"",padding:"0.25rem",onClick:t[2]||(t[2]=a=>D.value=!0),loading:i.value,disable:i.value},{default:n(()=>[l(y,{name:"sym_o_delete",size:"sm"})]),_:1},8,["loading","disable"])):R("",!0),l(c,{flat:"",padding:"0.25rem",onClick:t[3]||(t[3]=a=>$.value=!0),loading:i.value,disable:i.value},{default:n(()=>[l(y,{name:"sym_o_format_list_numbered",size:"sm"})]),_:1},8,["loading","disable"])]),_:1},8,["modelValue","options","loading","disable"])]),s.value?(w(),S("div",De,[l(g(Se),{ref_key:"urlRef",ref:h,label:"URL",modelValue:s.value.url,"onUpdate:modelValue":t[5]||(t[5]=a=>s.value.url=a),rules:m.value,hint:`e.g. ${g(oe)}`,dense:"",color:"secondary",prefix:"/v1/"},null,8,["modelValue","rules","hint"]),u("div",$e,[u("div",Be,[u("div",Re,[l(g(Ee),{class:"tower-editor",value:s.value.template,"onUpdate:value":t[6]||(t[6]=a=>s.value.template=a),lang:"liquid",theme:"monokai",style:{height:"calc(100vh - 21rem)"},options:{useWorker:!0,enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0,showPrintMargin:!1}},null,8,["value"])])]),u("div",null,[u("div",Ae,[Ie,Le,l(be,{spaced:"",class:"tw-bg-darkPage tw-mx-[-1px]"}),l(ge,{modelValue:s.value.returnType,"onUpdate:modelValue":t[7]||(t[7]=a=>s.value.returnType=a),label:"Return type",color:"secondary",options:["json","xml","plain text"],class:"tw-mx-3"},null,8,["modelValue"])])])])])):R("",!0),s.value?(w(),S("div",Pe,[l(Ve,{"save-enabled":g(P),onSaveClicked:O,loading:i.value,"has-errors":g(ne)},null,8,["save-enabled","loading","has-errors"])])):R("",!0)]))}});export{aa as default};
