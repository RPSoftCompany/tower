import{E as pe,a3 as we,x as n,m as he,d as g,J as b,k as V,aa as H,a as o,w as u,aL as ee,H as s,a7 as m,Q as f,a9 as ge,D as $,o as U,aG as ae,aH as C,a5 as le,a8 as q,aI as te,aJ as E,ac as _e,ad as ke,I as R,aK as D}from"./index.d78f815c.js";import{Q as oe}from"./QSeparator.ac17e27e.js";import{a as ye}from"./QSelect.77d64708.js";import{Q as _}from"./QInput.72a273ff.js";import{u as xe}from"./use-quasar.6ef15f16.js";import{_ as B}from"./towerSelect.9436c179.js";import{a as S,m as be,t as Ve,s as He,V as Ue}from"./ext-language_tools.ac726293.js";import{_ as Ce}from"./savePanel.faa1b35b.js";import{i as se}from"./index.d709224d.js";import{c as Ee}from"./browser.97da8d21.js";import"./use-key-composition.8fe7b499.js";import"./uid.42677368.js";import"./QMenu.c8dbaa4e.js";import"./selection.faaa34c1.js";import"./rtl.b51694b1.js";const Re={class:"text-h6"},De=s("div",{class:"text-h6"},"Set headers",-1),Se={class:"tw-grid tw-grid-cols-2 tw-gap-3"},Te={class:"tw-flex"},Pe={class:"tw-grid tw-grid-cols-3 tw-gap-3 tw-flex-grow"},Qe={key:0,class:"tw-mt-3"},Me={class:"tw-flex"},Ae={class:"tw-flex"},Le={class:"tw-flex-grow tw-mt-1"},Ne={class:"tw-p-1 tw-bg-dark tw-rounded"},$e={class:"tw-w-[20rem] tw-ml-3"},qe={class:"tw-mt-1 tw-flex tw-flex-col tw-py-3 tw-self-start tw-rounded tw-border tw-border-dark tw-bg-dark"},Be=s("div",{class:"tw-text-xl tw-font-medium tw-mx-3"},"Headers",-1),Ie=s("div",{class:"tw-text-gray-500 tw-mx-3"}," Add or remove headers from hook request ",-1),ze={class:"tw-mt-3 tw-flex tw-flex-col tw-py-3 tw-self-start tw-rounded tw-border tw-border-dark tw-bg-dark"},Oe=s("div",{class:"tw-text-xl tw-font-medium tw-mx-3"},"HTTP method",-1),je=s("div",{class:"tw-text-gray-500 tw-mx-3"},"Set hook's HTTP method",-1),Ge={class:"tw-mt-3"},ia=pe({__name:"HooksPage",setup(Je){const h=xe(),I=we(),c=n([]),d=n(""),v=n(""),r=n(null),t=n(null),T=n(!1),P=n(!1),p=n([]),k=n(""),y=n(""),Q=n(null),M=n(null),A=n(!1),x=[],L=n(null);he(async()=>{S.config.setModuleUrl("ace/mode/liquid",be),S.config.setModuleUrl("ace/theme/monokai",Ve),S.config.setModuleUrl("ace/snippets/liquid",He),x.push(j),x.push(G),x.push(J),S.require("ace/ext/language_tools"),await N()});const re=g(()=>{if(c.value){const a=[];return c.value.forEach(l=>{a.includes(l.model)||a.push(l.model)}),a.sort(),a}return[]}),ue=g(()=>{if(c.value&&d.value){const a=[];return c.value.filter(e=>e.model===d.value).forEach(e=>{a.includes(e.method)||a.push(e.method)}),a.sort(),a}return[]}),z=g(()=>{if(c.value&&d.value&&v.value){const a=c.value.find(l=>l.model===d.value&&l.method===v.value);if(a&&a.hooks)return a.hooks}return[]}),O=g(()=>{var a,l,e,i,w,W,F,K;return t.value?t.value.headers&&(t.value.headers.length!==((l=(a=r.value)==null?void 0:a.headers)==null?void 0:l.length)||t.value.headers.some(Y=>{var X;if((X=r.value)!=null&&X.headers)return!r.value.headers.some(Z=>Z.name===Y.name&&Z.value===Y.value)}))?!0:((e=t.value)==null?void 0:e.url)!==((i=r.value)==null?void 0:i.url)||((w=t.value)==null?void 0:w.method)!==((W=r.value)==null?void 0:W.method)||((F=t.value)==null?void 0:F.template)!==((K=r.value)==null?void 0:K.template):!1}),ne=g(()=>x.some(a=>{var l;return t.value?a((l=t.value)==null?void 0:l.url)!==!0:!1})),N=async()=>{T.value=!0;try{const a=await b.get("/hooks");a.status===200&&(c.value=a.data)}catch{h.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:"Error collecting hooks data"})}T.value=!1},de=()=>{var a,l;p.value=(a=t.value)!=null&&a.headers?[...(l=t.value)==null?void 0:l.headers]:[],P.value=!0},ie=()=>{t.value&&(t.value.headers=[...p.value])},j=a=>!!a||"URL can't be empty",G=a=>/^http(s)*:\/\//.test(a)?!0:"Invalid URL",J=a=>z.value.some(e=>{var i;return e.url===a&&((i=t.value)==null?void 0:i._id)!==e._id})?"Such URL exists already":!0,me=()=>{r.value=null,t.value={template:"{}",url:"",description:"",method:"GET",headers:[]},$(()=>{L.value&&L.value.validate()})},ce=()=>{A.value=!0},ve=async()=>{var a,l;if((a=t.value)!=null&&a._id){const e=c.value.find(i=>i.model===d.value&&i.method===v.value);try{e&&await b.delete(`/hooks/${e._id}/hookObject/${(l=t.value)==null?void 0:l._id}`),r.value=null,t.value=null,await N(),h.notify({color:"positive",position:"top",textColor:"secondary",message:"Hook configuration removed successfully"})}catch{h.notify({color:"negative",position:"top",textColor:"secondary",icon:se,message:"Error deleting removing configuration"})}}},fe=async()=>{var a;if(t.value){const l=c.value.find(e=>e.model===d.value&&e.method===v.value);if(!l)return;try{let e=null;(a=t.value)!=null&&a._id?e=await b.put(`/hooks/${l._id}/hookObject`,t.value):(t.value._id=Ee({length:10}),e=await b.post(`/hooks/${l._id}/hookObject`,t.value)),(e.status===200||e.status===201)&&(r.value={_id:e.data._id,url:e.data.url,method:e.data.method,template:e.data.template,description:e.data.description,headers:e.data.headers},await N(),h.notify({color:"positive",position:"top",textColor:"secondary",message:"Hook configuration saved successfully"}))}catch{h.notify({color:"negative",position:"top",textColor:"secondary",icon:se,message:"Error saving hook configuration"})}}};return V(()=>r.value,a=>{a&&(t.value={_id:a._id,description:a.description,method:a.method,url:a.url,template:a.template,headers:a.headers})}),V(()=>k.value,a=>{a&&p.value&&(p.value.push({name:a,value:""}),$(()=>{if(Q.value){const l=Q.value;l[l.length-1].focus(),k.value=""}}))}),V(()=>y.value,a=>{a&&p.value&&(p.value.push({name:"",value:a}),$(()=>{if(M.value){const l=M.value;l[l.length-1].focus(),y.value=""}}))}),V(()=>O.value,a=>{a&&!T.value?I.preventNavigation():I.allowNavigation()}),(a,l)=>(U(),H("div",null,[o(ee,{modelValue:A.value,"onUpdate:modelValue":l[0]||(l[0]=e=>A.value=e)},{default:u(()=>[o(ae,{class:"tw-min-w-[30%]"},{default:u(()=>[o(C,{class:"tw-bg-negative"},{default:u(()=>{var e;return[s("div",Re,"Delete "+le((e=t.value)==null?void 0:e.url)+" hook",1)]}),_:1}),o(C,null,{default:u(()=>[q(" Are you sure you want to delete "),s("b",null,le(t.value),1),q(" hook? ")]),_:1}),o(te,{align:"right"},{default:u(()=>[E(o(f,{color:"secondary",flat:"",label:"Cancel"},null,512),[[D]]),E(o(f,{color:"negative",flat:"",label:"Yes",onClick:ve},null,512),[[D]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(ee,{modelValue:P.value,"onUpdate:modelValue":l[3]||(l[3]=e=>P.value=e)},{default:u(()=>[o(ae,{class:"tw-min-w-[30rem]"},{default:u(()=>[o(C,{class:"tw-bg-dark"},{default:u(()=>[De]),_:1}),o(C,{class:"tw-bg-darkPage"},{default:u(()=>[(U(!0),H(_e,null,ke(p.value,(e,i)=>(U(),H("div",{class:"tw-grid tw-grid-cols-2 tw-gap-3",key:i},[o(m(_),{ref_for:!0,ref_key:"headerNameRef",ref:Q,modelValue:e.name,"onUpdate:modelValue":w=>e.name=w,label:"Header",dense:"",color:"secondary"},null,8,["modelValue","onUpdate:modelValue"]),o(m(_),{ref_for:!0,ref_key:"headerValueRef",ref:M,modelValue:e.value,"onUpdate:modelValue":w=>e.value=w,label:"Value",dense:"",color:"secondary"},{after:u(()=>[o(f,{flat:"",padding:"0.25rem"},{default:u(()=>[o(R,{name:"sym_o_delete",size:"sm"})]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128)),s("div",Se,[o(m(_),{modelValue:k.value,"onUpdate:modelValue":l[1]||(l[1]=e=>k.value=e),debounce:"300",label:"Header",dense:"",color:"secondary"},null,8,["modelValue"]),o(m(_),{modelValue:y.value,"onUpdate:modelValue":l[2]||(l[2]=e=>y.value=e),debounce:"300",label:"Value",dense:"",color:"secondary"},null,8,["modelValue"])])]),_:1}),o(te,{align:"right",class:"tw-bg-darkPage"},{default:u(()=>[E(o(f,{color:"secondary",flat:"",label:"Cancel"},null,512),[[D]]),E(o(f,{color:"secondary",flat:"",label:"Save",onClick:ie},null,512),[[D]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s("div",Te,[s("div",Pe,[o(B,{modelValue:d.value,"onUpdate:modelValue":[l[4]||(l[4]=e=>d.value=e),l[5]||(l[5]=e=>{r.value=null,t.value=null,v.value=""})],label:"Model",options:m(re)},null,8,["modelValue","options"]),o(B,{modelValue:v.value,"onUpdate:modelValue":[l[6]||(l[6]=e=>v.value=e),l[7]||(l[7]=e=>{r.value=null,t.value=null})],disable:!d.value,label:"Method",options:m(ue)},null,8,["modelValue","disable","options"]),o(B,{modelValue:r.value,"onUpdate:modelValue":l[8]||(l[8]=e=>r.value=e),disable:!d.value,label:"Hook","option-label":"url",options:m(z)},null,8,["modelValue","disable","options"])]),o(f,{flat:"",padding:"0.25rem",class:"tw-ml-3",onClick:me,disable:!v.value||!d.value},{default:u(()=>[o(R,{name:"sym_o_add",size:"sm"})]),_:1},8,["disable"]),o(f,{flat:"",padding:"0.25rem",class:"tw-ml-3",disable:!r.value,onClick:ce},{default:u(()=>[o(R,{name:"sym_o_delete",size:"sm"})]),_:1},8,["disable"])]),t.value?(U(),H("div",Qe,[s("div",Me,[o(m(_),{modelValue:t.value.url,"onUpdate:modelValue":l[9]||(l[9]=e=>t.value.url=e),ref_key:"currentHookUrlRef",ref:L,label:"URL",rules:[j,G,J],color:"secondary",dense:"",class:"tw-flex-grow"},null,8,["modelValue","rules"])]),s("div",Ae,[s("div",Le,[s("div",Ne,[o(m(Ue),{value:t.value.template,"onUpdate:value":l[10]||(l[10]=e=>t.value.template=e),class:"tower-editor tw-flex-grow",lang:"liquid",theme:"monokai",style:{height:"calc(100vh - 21rem)"},options:{useWorker:!0,enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0,showPrintMargin:!1}},null,8,["value"])])]),s("div",$e,[s("div",qe,[Be,Ie,o(oe,{spaced:"",class:"tw-bg-darkPage tw-mx-[-1px]"}),o(f,{class:"tw-bg-secondary tw-mx-3 tw-flex-grow",flat:"","text-color":"primary",onClick:de},{default:u(()=>[o(R,{class:"tw-mr-3",color:"primary",name:"sym_o_send_time_extension",size:"sm"}),q(" Headers ")]),_:1})]),s("div",ze,[Oe,je,o(oe,{spaced:"",class:"tw-bg-darkPage tw-mx-[-1px]"}),o(ye,{modelValue:t.value.method,"onUpdate:modelValue":l[11]||(l[11]=e=>t.value.method=e),label:"HTTP method",class:"tw-mx-3",dense:"",color:"secondary",options:["DELETE","GET","HEAD","PATCH","POST","PUT"]},null,8,["modelValue"])])])]),s("div",Ge,[o(Ce,{"save-enabled":m(O),onSaveClicked:fe,"has-errors":m(ne)},null,8,["save-enabled","has-errors"])])])):ge("",!0)]))}});export{ia as default};
