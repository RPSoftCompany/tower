import{E as $,ae as E,a3 as I,x as v,d as A,k as J,aa as _,H as V,a as c,a7 as h,w as d,a9 as x,J as g,o as m,ac as k,ad as L,c as O,I as D,a8 as U,a5 as j}from"./index.d78f815c.js";import{b as C,Q as q}from"./QMenu.c8dbaa4e.js";import{Q as z}from"./QSelect.77d64708.js";import{Q as F}from"./QList.7f34605a.js";import{_ as S}from"./towerSelect.9436c179.js";import{u as H}from"./use-quasar.6ef15f16.js";import{_ as R}from"./savePanel.faa1b35b.js";import"./selection.faaa34c1.js";import"./use-key-composition.8fe7b499.js";import"./uid.42677368.js";import"./rtl.b51694b1.js";const T={class:"tw-flex tw-flex-col tw-h-full"},G={class:"tw-flex tw-justify-center"},K={key:0,class:"tw-mt-5 tw-flex tw-flex-col tw-h-full"},W=V("div",{class:"tw-flex-grow"},null,-1),ue=$({__name:"PromotionsPage",setup(X){const f=H(),Q=E(),y=I(),r=v(null),p=v([]),i=v(null),l=v(null),e=v(null),s=v(!1),w=A(()=>{var a,o;return!l.value||!e.value?!1:!l.value._id||((a=l.value)==null?void 0:a.toModels.length)!==((o=e.value)==null?void 0:o.toModels.length)?!0:l.value.toModels.some(t=>{var u;return!((u=e.value)!=null&&u.toModels.some(n=>t===n))})}),N=async()=>{if(p.value=[],!r.value)return;i.value=null,s.value=!0;const a={where:{base:r.value.name},order:"name ASC"};try{const o=await g.get(`/configurationModels?filter=${JSON.stringify(a,void 0,"")}`);o.status===200&&(p.value=o.data)}catch{f.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:"Error collecting configuration model data"})}s.value=!1},M=async()=>{var o,t,u;if(l.value=null,!i.value||!r.value)return;s.value=!0;const a={where:{base:r.value.name,fromModel:i.value.name}};try{const n=await g.get(`/promotions?filter=${JSON.stringify(a,void 0,"")}`);n.status===200&&(n.data.length>0?(l.value=n.data[0],l.value&&(e.value={_id:(o=l.value)==null?void 0:o._id,toModels:[...l.value.toModels],base:l.value.base,fromModel:l.value.fromModel})):(l.value={base:(t=r.value)==null?void 0:t.name,fromModel:(u=i.value)==null?void 0:u.name,toModels:[]},e.value={toModels:[...l.value.toModels],base:l.value.base,fromModel:l.value.fromModel}))}catch{f.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:"Error collecting promotions data"})}s.value=!1},P=a=>{e.value&&(e.value.toModels.includes(a)?e.value.toModels=e.value.toModels.filter(o=>o!==a):e.value.toModels.push(a))},B=async()=>{if(e.value){s.value=!0;let a=null;try{e.value._id?a=await g.patch(`/promotions/${e.value._id}`,e.value):a=await g.post("/promotions",e.value),a.status===200&&await M(),f.notify({color:"positive",position:"top",textColor:"secondary",message:"Promotion data saved successfully"})}catch{f.notify({color:"negative",position:"top",textColor:"secondary",icon:"sym_o_error",message:"Error saving promotions data"})}s.value=!1}};return J(()=>w.value,a=>{a&&!s.value?y.preventNavigation():y.allowNavigation()}),(a,o)=>(m(),_("div",T,[V("div",G,[c(S,{modelValue:r.value,"onUpdate:modelValue":[o[0]||(o[0]=t=>r.value=t),N],label:"Base","option-label":"name",options:h(Q).getBases,class:"tw-w-[33.3%]",loading:s.value},null,8,["modelValue","options","loading"]),c(S,{modelValue:i.value,"onUpdate:modelValue":[o[1]||(o[1]=t=>i.value=t),M],disable:!r.value,label:"Promote from","option-label":"name",options:p.value,class:"tw-w-[33.3%] tw-ml-3",loading:s.value},null,8,["modelValue","disable","options","loading"])]),e.value&&i.value?(m(),_("div",K,[c(F,null,{default:d(()=>[(m(!0),_(k,null,L(p.value,t=>{var u;return m(),_(k,{key:t.name},[t.name!==((u=i.value)==null?void 0:u.name)?(m(),O(q,{key:0,clickable:"",onClick:n=>P(t.name),disable:s.value},{default:d(()=>[c(C,{avatar:""},{default:d(()=>{var n,b;return[c(D,{name:(n=e.value)!=null&&n.toModels.includes(t.name)?"sym_o_check":"sym_o_check_box_outline_blank",color:(b=e.value)!=null&&b.toModels.includes(t.name)?"positive":"grey-7",class:"heavy",size:"sm"},null,8,["name","color"])]}),_:2},1024),c(C,null,{default:d(()=>[c(z,null,{default:d(()=>[U(j(t.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick","disable"])):x("",!0)],64)}),128))]),_:1}),W,c(R,{"save-enabled":h(w),onSaveClicked:B},null,8,["save-enabled"])])):x("",!0)]))}});export{ue as default};
